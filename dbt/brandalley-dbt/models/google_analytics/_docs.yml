version: 2

models:
  - name: ga_daily_stats
    description: "GA visit and transaction counts"
    meta:
      label: "Conversions GA"
      joins:
        - join: products
          sql_on: ${ga_daily_stats.product_sku} = ${products.sku}
        - join: products_sales
          sql_on: ${products.product_id} = ${products_sales.product_id}
    columns:
      - name: date
        meta:
          dimension:
            type: date
      - name: is_new_user
        meta:
          dimension:
            type: boolean
      - name: traffic_channel
      - name: traffic_medium
      - name: traffic_campaign
      - name: traffic_source
      - name: device_browser
      - name: device_os
        meta:
          dimension:
            label: 'Device OS'
      - name: product_sku
      - name: product_name
      - name: product_brand
      - name: product_quantity
        meta:
          metrics:
            total_quantity_metric:
              label: 'Quantity ordered'
              type: sum
              description: "Total quantity ordered"
      - name: transaction_id
        meta:
          metrics:
            total_transactions_metric:
              label: 'Transactions'
              type: count_distinct
              description: "Count of transactions"
            ga_conversion_rate:
              label: 'Conversion Rate (%)'
              type: number 
              description: 'Total transactions / Total visits'
              sql: "100*safe_divide(${total_transactions_metric},${total_visits_metric})"
              round: 2
      - name: product_revenue
        meta:
          metrics:
            total_revenue_metric:
              label: 'GMV (Â£)'
              type: sum
              description: "GMV"
              round: 0
      - name: unique_visit_id
        meta:
          metrics:
            total_visits_metric:
              label: 'Visits'
              type: count_distinct
              description: "Total visits"