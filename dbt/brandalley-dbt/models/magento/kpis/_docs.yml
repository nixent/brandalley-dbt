version: 2

models:
  - name: kpis_daily
    description: "A view of all KPIs, based off of order creation day"
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_day
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_achica_order_count
      - name: total_new_customer_count
      - name: total_existing_customer_count
      - name: total_new_members
      - name: total_new_achica_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£)'
            round: 0
            format: 'gbp' 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£)'
            round: 0
            format: 'gbp' 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0
            format: 'gbp' 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£)'
            round: 0
            format: 'gbp' 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£)'
            round: 0
            format: 'gbp' 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£)'
            round: 0
            format: 'gbp' 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£)'
            round: 0
            format: 'gbp' 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£)'
            round: 0
            format: 'gbp' 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£)'
            round: 1
            format: 'gbp' 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£)'
            round: 1
            format: 'gbp' 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  - name: kpis_weekly
    description: "A view of all KPIs, based off of order creation week"
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_week
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£)'
            round: 0
            format: 'gbp' 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£)'
            round: 0
            format: 'gbp' 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0
            format: 'gbp' 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£)'
            round: 0
            format: 'gbp' 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£)'
            round: 0
            format: 'gbp' 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£)'
            round: 0
            format: 'gbp' 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£)'
            round: 0
            format: 'gbp' 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£)'
            round: 0
            format: 'gbp' 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£)'
            round: 1
            format: 'gbp' 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£)'
            round: 1
            format: 'gbp' 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  - name: kpis_monthly
    description: "A view of all KPIs, based off of order creation month"
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_month
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£)'
            round: 0
            format: 'gbp' 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£)'
            round: 0
            format: 'gbp' 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0
            format: 'gbp' 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£)'
            round: 0
            format: 'gbp' 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£)'
            round: 0
            format: 'gbp' 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£)'
            round: 0
            format: 'gbp' 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£)'
            round: 0
            format: 'gbp' 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£)'
            round: 0
            format: 'gbp' 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£)'
            round: 1
            format: 'gbp' 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£)'
            round: 1
            format: 'gbp' 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  - name: kpis_quarterly
    description: "A view of all KPIs, based off of order creation quarter"
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_quarter
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£)'
            round: 0
            format: 'gbp' 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£)'
            round: 0
            format: 'gbp' 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0
            format: 'gbp' 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£)'
            round: 0
            format: 'gbp' 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£)'
            round: 0
            format: 'gbp' 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£)'
            round: 0
            format: 'gbp' 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£)'
            round: 0
            format: 'gbp' 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£)'
            round: 0
            format: 'gbp' 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£)'
            round: 1
            format: 'gbp' 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£)'
            round: 1
            format: 'gbp' 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  