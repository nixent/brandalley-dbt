version: 2

models:
  - name: daily_sales
    columns:
      - name: date_day
        meta:
          dimension:
            type: date
            label: 'Date'
      - name: ba_site
        meta:
          dimension:
            label: 'BA Site'
      - name: ga_orders
        meta:
          dimension:
            label: 'GA Orders'
      ######### ORDERS #########
      - name: total_order_count
        meta:
          dimension:
            hidden: true
          metrics:
            total_orders_count:
              type: sum
              label: 'Orders'
      - name: last_year_total_order_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_total_order_count:
              type: sum
              label: 'LY Orders (MTD or YTD)'
              group_label: 'Last Year'
            last_year_same_day_mtd_ytd_total_order_comparison:
              type: number
              sql: '${total_orders_count} - ${last_year_mtd_ytd_total_order_count}'
              label: 'LY Orders Comparison (MTD or YTD)'
              group_label: 'Last Year'
            last_year_same_day_mtd_ytd_total_order_comparison_pct:
              type: number
              sql: '100*safe_divide(${total_orders_count} - ${last_year_mtd_ytd_total_order_count},${last_year_mtd_ytd_total_order_count})'
              label: 'LY Orders Comparison % (MTD or YTD)'
              group_label: 'Last Year'
              round: 1
      - name: last_year_same_day_total_order_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_total_order_count:
              type: sum
              label: 'LY Orders (Day or WTD)'
              group_label: 'Last Year'
            last_year_same_day_wtd_total_order_comparison:
              type: number
              sql: '${total_orders_count} - ${last_year_same_day_wtd_total_order_count}'
              label: 'LY Orders Comparison (Day or WTD)'
              group_label: 'Last Year VS'
            last_year_same_day_wtd_total_order_comparison_pct:
              type: number
              sql: '100*safe_divide(${total_orders_count} - ${last_year_same_day_wtd_total_order_count},${last_year_same_day_wtd_total_order_count})'
              label: 'LY Orders Comparison % (Day or WTD)'
              group_label: 'Last Year VS'
              round: 1
      - name: all_orders_forecast
        meta:
          dimension:
            hidden: true
          metrics:
            total_all_orders_forecast:
              type: sum
              label: 'All Orders Forecast'
              group_label: 'Targets'
            total_order_wtd_forecast_comparison:
              type: number
              sql: '${total_orders_count} - ${total_all_orders_forecast}'
              label: 'LY Orders Forecast Comparison (Day or WTD)'
              group_label: 'Targets VS'
            total_order_wtd_forecase_comparison_pct:
              type: number
              sql: '100*safe_divide(${total_orders_count} - ${total_all_orders_forecast},${total_all_orders_forecast})'
              label: 'LY Orders Forecast Comparison % (Day or WTD)'
              group_label: 'Targets VS'
              round: 1
      ##### CUSTOMERS #######
      - name: total_new_customer_count
        meta:
          dimension:
            hidden: true
          metrics:
            total_new_customers_count:
              type: sum
              label: 'New Customers'
      - name: last_year_total_new_customer_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_total_new_customer_count:
              type: sum
              label: 'LY New Customers (MTD or YTD)'
              group_label: 'Last Year'
      - name: last_year_same_day_total_new_customer_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_total_new_customer_count:
              type: sum
              label: 'LY New Customers (Day or WTD)'
              group_label: 'Last Year'
            last_year_same_day_wtd_new_customer_comparison:
              type: number
              sql: '${total_new_customers_count} - ${last_year_same_day_wtd_total_new_customer_count}'
              label: 'LY New Customers Comparison (Day or WTD)'
              group_label: 'Last Year VS'
            last_year_same_day_wtd_new_customer_comparison_pct:
              type: number
              sql: '100*safe_divide(${total_new_customers_count} - ${last_year_same_day_wtd_total_new_customer_count},${last_year_same_day_wtd_total_new_customer_count})'
              label: 'LY New Customers Comparison % (Day or WTD)'
              group_label: 'Last Year VS'
              round: 1
      ##### MEMBERS ######
      - name: total_new_members
        meta:
          dimension:
            hidden: true
          metrics:
            total_new_members_count:
              type: sum
              label: 'New Members'
      - name: last_year_total_new_member_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_total_new_member_count:
              type: sum
              label: 'LY New Members (MTD or YTD)'
              group_label: 'Last Year'
      - name: last_year_same_day_total_new_member_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_total_new_member_count:
              type: sum
              label: 'LY New Members (Day or WTD)'
              group_label: 'Last Year'
            last_year_same_day_wtd_new_member_comparison:
              type: number
              sql: '${total_new_members_count} - ${last_year_same_day_wtd_total_new_members_count}'
              label: 'LY New Members Comparison (Day or WTD)'
              group_label: 'Last Year VS'
            last_year_same_day_wtd_new_member_comparison_pct:
              type: number
              sql: '100*safe_divide(${total_new_members_count} - ${last_year_same_day_wtd_total_new_member_count},${last_year_same_day_wtd_total_new_member_count})'
              label: 'LY New Members Comparison % (Day or WTD)'
              group_label: 'Last Year VS'
              round: 1
      - name: new_members_forecast
        meta:
          dimension:
            hidden: true
          metrics:
            total_new_members_forecast:
              type: sum
              label: 'New Members Forecast'
              group_label: 'Targets'
      ######## AOV GMV #######
      ### TO DO - AVG TOTAL GMV / TOTAL ORDERS
      # - name: aov_gmv
      #   meta:
      #     dimension:
      #       hidden: true
      #     metrics:
      #       total_aov_gmv:
      #         type: number
      #         label: 'AOV GMV'
      - name: last_year_aov_gmv
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_aov_gmv:
              type: sum
              label: 'LY AOV GMV (MTD or YTD)'
              group_label: 'Last Year'
      - name: last_year_same_day_aov_gmv
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_aov_gmv:
              type: sum
              label: 'LY AOV GMV (Day or WTD)'
              group_label: 'Last Year'
            # last_year_same_day_wtd_aov_gmv_comparison:
            #   type: number
            #   sql: '${total_aov_gmv} - ${last_year_same_day_wtd_total_aov_gmv}'
            #   label: 'LY New Customers Comparison (Day or WTD)'
            #   group_label: 'Last Year VS'
            # last_year_same_day_wtd_aov_gmv_comparison_pct:
            #   type: number
            #   sql: '100*safe_divide(${total_aov_gmv} - ${last_year_same_day_wtd_total_aov_gmv},${last_year_same_day_wtd_total_aov_gmv})'
            #   label: 'LY New Customers Comparison % (Day or WTD)'
            #   group_label: 'Last Year VS'
            #   round: 1
      #### GMV ######
      - name: gmv
        meta:
          dimension:
            hidden: true
          metrics:
            total_gmv:
              type: sum
              label: 'GMV'
      - name: last_year_gmv
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_gmv:
              type: sum
              label: 'LY GMV (MTD or YTD)'
              group_label: 'Last Year'
      - name: last_year_same_day_gmv
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_gmv:
              type: sum
              label: 'LY GMV (Day or WTD)'
              group_label: 'Last Year'
            last_year_same_day_wtd_gmv_comparison:
              type: number
              sql: '${total_gmv} - ${last_year_same_day_wtd_gmv}'
              label: 'LY GMV Comparison (Day or WTD)'
              group_label: 'Last Year VS'
            last_year_same_day_wtd_gmv_comparison_pct:
              type: number
              sql: '100*safe_divide(${total_gmv} - ${last_year_same_day_wtd_gmv},${last_year_same_day_wtd_gmv})'
              label: 'LY GMV Comparison % (Day or WTD)'
              group_label: 'Last Year VS'
              round: 1
      ##### MARGIN #######
      - name: margin
        meta:
          dimension:
            hidden: true
          metrics:
            total_margin:
              type: sum
              label: 'Margin'
      - name: last_year_margin
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_margin:
              type: sum
              label: 'LY Margin (MTD or YTD)'
              group_label: 'Last Year'
      - name: last_year_same_day_margin
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_margin:
              type: sum
              label: 'LY Margin (Day or WTD)'
              group_label: 'Last Year'
            last_year_same_day_wtd_margin_comparison:
              type: number
              sql: '${total_margin} - ${last_year_same_day_wtd_margin}'
              label: 'LY Margin Comparison (Day or WTD)'
              group_label: 'Last Year VS'
            last_year_same_day_wtd_margin_comparison_pct:
              type: number
              sql: '100*safe_divide(${total_margin} - ${last_year_same_day_wtd_margin},${last_year_same_day_wtd_margin})'
              label: 'LY Margin Comparison % (Day or WTD)'
              group_label: 'Last Year VS'
              round: 1


      #### QTY ORDERED
      - name: qty_ordered
        meta:
          dimension:
            hidden: true
          metrics:
            total_qty_ordered:
              type: sum
              label: 'Units Ordered'
      - name: last_year_qty_ordered
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_qty_ordered:
              type: sum
              label: 'LY Units Ordered (MTD or YTD)'
              group_label: 'Last Year'
      - name: last_year_same_day_qty_ordered
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_qty_ordered:
              type: sum
              label: 'LY Units Ordered (Day or WTD)'
              group_label: 'Last Year'


      #### UNIQUE VISITS
      - name: ga_unique_visits
        meta:
          dimension:
            hidden: true
          metrics:
            total_ga_unique_visits:
              type: sum
              label: 'Unique Visits'
      - name: last_year_same_day_ga_unique_visits
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_ga_unique_visits:
              type: sum
              label: 'LY Unique Visits (Day or WTD)'
              group_label: 'Last Year'
      

  - name: kpis_daily
    description: "A view of all KPIs, based off of order creation day"
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_day
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_achica_order_count
      - name: total_new_cocosa_order_count
      - name: total_new_ifg_order_count
      - name: total_new_customer_count
      - name: total_existing_customer_count
      - name: total_new_members
      - name: total_new_achica_members
      - name: total_new_cocosa_members
      - name: total_new_ifg_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£/€)'
            round: 0 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£/€)'
            round: 0 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
        meta:
          dimension:
            label: 'Units Ordered'
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£/€)'
            round: 0 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£/€)'
            round: 0 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£/€)'
            round: 0 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£/€)'
            round: 0 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£/€)'
            round: 0 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£/€)'
            round: 1 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£/€)'
            round: 1 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  - name: kpis_weekly
    description: "A view of all KPIs, based off of order creation week"
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_week
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£/€)'
            round: 0 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£/€)'
            round: 0 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
        meta:
          dimension:
            label: 'Units Ordered'
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£/€)'
            round: 0 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£/€)'
            round: 0 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£/€)'
            round: 0 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£/€)'
            round: 0 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£/€)'
            round: 0 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£/€)'
            round: 1 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£/€)'
            round: 1 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  - name: kpis_monthly
    description: "A view of all KPIs, based off of order creation month"
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_month
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£/€)'
            round: 0 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£/€)'
            round: 0 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
        meta:
          dimension:
            label: 'Units Ordered'
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£/€)'
            round: 0 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£/€)'
            round: 0 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£/€)'
            round: 0 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£/€)'
            round: 0 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£/€)'
            round: 0 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£/€)'
            round: 1 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£/€)'
            round: 1 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  - name: kpis_quarterly
    description: "A view of all KPIs, based off of order creation quarter"
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_quarter
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£/€)'
            round: 0 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£/€)'
            round: 0 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
        meta:
          dimension:
            label: 'Units Ordered'
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£/€)'
            round: 0 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£/€)'
            round: 0 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£/€)'
            round: 0 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£/€)'
            round: 0 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£/€)'
            round: 0 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£/€)'
            round: 1 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£/€)'
            round: 1 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  