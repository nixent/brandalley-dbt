version: 2

models:
  - name: catalog_product_negotiation_item
    description: ""
    meta:
      group_label: 'Products'
    columns:
      - name: ba_site
      - name: negotiation_item_id
        description: "Primary key"
        meta:
          dimension:
            format: id
      - name: negotiation_id
        description: "Negotiation id"
        meta:
          dimension:
            format: id
      - name: updated_at
        description: "Update time, nullable"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: product_id
        description: "Product id"
      - name: product_parent_id
        description: "Product parent id"
      - name: sku
        description: "SKU"
      - name: parrent_sku
        description: "Parent SKU"
      - name: reference
        description: "Reference"
      - name: name
        description: "Name"
      - name: size
        description: "Size"
      - name: brand
        description: "Brand"
      - name: commodity_code
        description: "Commodity code"
      - name: pack_size
        description: "Pack size"
      - name: cost
        description: "Cost"
      - name: cost_gbp
        description: "Cost in GBP"
      - name: rrp
        description: "RRP"
      - name: price
        description: "Price"
        meta:
          metrics:
            negotiation_price:
              label: 'Negotiation price'
              type: sum
              description: "Price entered in the reservation sheet"
              hidden: false
              round: 2
      - name: tax_rate
        description: "Tax rate"
      - name: tax_code
        description: "Tax code"
      - name: qty
        description: "Quantity"
      - name: ordered
        description: "Ordered"
      - name: to_order
        description: "To order"
      - name: qty_exported
        description: "Quantity exported"

  - name: catalog_product_negotiation
    meta:
      group_label: 'Products'
    description: ""
    columns:
      - name: ba_site
      - name: negotiation_id
        description: "Primary key"
        meta:
          dimension:
            format: id
      - name: updated_at
        description: "Update time, nullable"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: parent
        description: "Parent, nullable"
      - name: sap_ref
        description: "SAP ref"
      - name: type
        description: "Type"
      - name: supplier
        description: "Supplier"
      - name: currency
        description: "Currency"
      - name: rate
        description: "Rate"
      - name: cost
        description: "Cost"
      - name: price
        description: "Price"
      - name: status
        description: "Status"
      - name: admin
        description: "Admin"
      - name: date_import
        description: "Date import"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: date_reservation
        description: "Date reservation"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: date_pend_proc
        description: "Date pend proc"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: date_proc_comp
        description: "Date proc comp"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: date_comp_exported
        description: "Date comp exported"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: date_due
        description: "Date due"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: sap_message
        description: "SAP message, nullable"
      - name: buyer
        description: "Buyer, nullable"
      - name: department
        description: "Department, nullable"

  - name: catalog_product_negotiation_sfoi_joined
    description: ""
    columns:
      - name: ba_site
      - name: negotiation_id
        description: "Primary key"
        meta:
          dimension:
            format: id
      - name: po_date
        description: "PO date"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: sku
        description: "SKU"
      - name: order_id
        description: "order_id"
        meta:
          dimension:
            format: id
      - name: consignment_ordered
        description: "Qty of consignment units ordered"
      - name: created_at
        description: "Create date"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: brand
        description: "Brand"
      - name: name
        description: "Name of the product"
      - name: reference_ref
        description: "Reference"
      - name: supplier_id
        description: "Supplier id"
        meta:
          dimension:
            format: id
      - name: SAP ref
        description: "SAP ref"

  - name: catalog_product
    columns:
      - name: ba_site
      - name: entity_id
      - name: sku
      - name: cost

  - name: categories
    description: ""
    columns:
      - name: ba_site
      - name: u_unique_id
        description: ""
        meta:
          dimension:
            format: id
      - name: category_id
        description: ""
        meta:
          dimension:
            format: id
      - name: parent_category_id
        description: ""
        meta:
          dimension:
            format: id
      - name: category_name
        description: ""
      - name: parent_category_name
        description: ""
      - name: active
        description: ""
      - name: path
        description: "Tree Path"
      - name: level
        description: "Tree level"
      - name: updated_at
        description: "Update time, nullable"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']

  - name: products
    description: ""
    meta:
      group_label: 'Products'
    columns:
      - name: ba_site_variant_sku
        description: ""
        tests:
          - unique
          - not_null
        meta:
          dimension:
            format: id
            hidden: true
      - name: ba_site
        meta:
          dimension:
            label: 'BA Site'
      - name: product_id
        description: "Product id"
        meta:
          dimension:
            format: id
            label: 'Parent Product ID'
      - name: dt_cr
        description: ""
        meta:
          dimension:
            label: "Product Created At"
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: variant_product_id
        description: ""
        meta:
          dimension:
            format: id
            label: 'Variant Product ID'
      - name: sku
        description: "SKU, nullable"
        meta:
          dimension:
            label: 'Parent SKU'
      - name: variant_sku
        description: ""
        meta:
          dimension:
            label: 'Variant SKU'
      - name: sap_product_id
        description: ""
        meta:
          dimension:
            format: id
            label: 'SAP Product ID'
      - name: name
        description: "Name"
        meta:
          dimension:
            label: 'Product Name'
      - name: description
        description: ""
        meta:
          dimension:
            label: 'Product Description'
      - name: brand
        description: ""
        meta:
          dimension:
            label: 'Product Brand'
      - name: supplier
        description: ""
      - name: outlet_category
        description: ""
      - name: product_type
        description: ""
      - name: availability
        description: ""
      - name: outlet_price
        description: ""
        meta:
          dimension:
            group_label: 'Prices'
      - name: color
        description: ""
        meta:
          dimension:
            label: 'Product Color'
      - name: size
        description: ""
        meta:
          dimension:
            label: 'Product Size'
      - name: stock
        description: ""
      - name: price
        description: ""
        meta:
          dimension:
            group_label: 'Prices'
      - name: sale_price
        description: ""
        meta:
          dimension:
            group_label: 'Prices'
      - name: sale_price_tax_amount
        description: ""
        meta:
          dimension:
            group_label: 'Prices'
      - name: cost
        description: ""
        meta:
          dimension:
            label: 'Product Cost'
      - name: product_margin
        description: ""
        meta:
          dimension:
            label: 'Product Margin'
      - name: tax_class
        description: ""
      - name: updated_at
        description: "Update time"
        meta:
          dimension:
            label: 'Product Updated At'
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: supplier_id
        description: "Primary key"
        meta:
          dimension:
            format: id
            label: 'Supplier ID'
      - name: supplier_name
        description: ""
      - name: supplier_reference
      - name: original_size
      - name: barcode
        description: ""
        meta:
          dimension:
            label: 'Product Barcode'
      - name: product_image
      - name: buyer_id
      - name: buyer
      - name: gender
      - name: product_category_level_1
      - name: product_category_level_2
      - name: product_category_level_3
      - name: is_deleted
        description: 'If the product still exists in the Magento table currently'
        meta:
          dimension:
            type: boolean
      - name: parent_sku_visibility
      - name: is_variant_sku_enabled
        meta:
          dimension:
            type: boolean
      - name: is_parent_sku_enabled
        meta:
          dimension:
            type: boolean
        

  - name: inventory_items
    description: ""
    meta:
      group_label: 'Products'
    columns:
      - name: ba_site
      - name: item_id
        description: "Primary key"
        meta:
          dimension:
            format: id
            
      - name: product_id
        description: "Product id"
        meta:
          dimension:
            format: id
            
      - name: stock_id
        description: "Stock id"
        meta:
          dimension:
            format: id
            
      - name: qty
        description: "Quantity"

      - name: min_qty
        description: "Min Quantity"

      - name: use_config_min_qty
        description: "Use config min quantity"

      - name: is_qty_decimal
        description: "Is quantity decimal"

      - name: backorders
        description: "Backorders"

      - name: use_config_backorders
        description: "Use config backorders"

      - name: min_sale_qty
        description: "Min sale quantity"

      - name: use_config_min_sale_qty
        description: "Use config min sale quantity"

      - name: max_sale_qty
        description: "Max sale quantity"

      - name: use_config_max_sale_qty
        description: "Use config min sale quantity"

      - name: is_in_stock
        description: "Is in stock"

      - name: low_stock_date
        description: "Low stock date, nullable"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']

      - name: notify_stock_qty
        description: "Notify stock quantity, nullable"

      - name: use_config_notify_stock_qty
        description: "Use config notify stock quantity"

      - name: manage_stock
        description: "Manage stock"

      - name: use_config_manage_stock
        description: "Use config manage stock"

      - name: stock_status_changed_auto
        description: "Stock status changed auto"

      - name: use_config_qty_increments
        description: "Use config quantity increments"

      - name: qty_increments
        description: "Quantity increments"

      - name: use_config_enable_qty_inc
        description: "Use config enable quantity inc"

      - name: enable_qty_increments
        description: "Enable quantoty increments"

      - name: is_decimal_divided
        description: "Is decimal divided"

  - name: nego_quotas
    description: 'Details on initial negotiation quantities and subsequent units sold'
    meta:
      group_label: 'Products'
    columns:
      - name: ba_site_negotiation_item_id
        tests:
          - unique
          - not_null
        meta:
          dimension:
            hidden: true
      - name: negotiation_item_id
      - name: ba_site
      - name: negotiation_id
      - name: nego_updated_at
      - name: variant_sku
      - name: nego_qty
        meta:
          dimension:
            hidden: true
          metrics:
            total_nego_qty:
              type: sum
      - name: po_qty
        meta:
          dimension:
            hidden: true
          metrics:
            total_po_qty:
              type: sum
      - name: product_color
      - name: product_size
      - name: outlet_category
      - name: product_brand
      - name: gmv
        meta:
          dimension:
            hidden: true
          metrics:
            total_nego_gmv:
              type: sum
      - name: sales_amount
        meta:
          dimension:
            hidden: true
          metrics:
            total_nego_sales_amount:
              type: sum
      - name: margin
        meta:
          dimension:
            hidden: true
          metrics:
            total_nego_margin:
              type: sum
      - name: qty_sold
        meta:
          dimension:
            hidden: true
          metrics:
            total_nego_qty_sold:
              type: sum

  - name: product_fulfillment_types_daily
    columns:
      - name: date_day
      - name: ba_site
      - name: parent_sku
      - name: shipment_type

  - name: products_sales
    description: ""
    meta:
      group_label: 'Products'
    columns:
      - name: ba_site
        meta:
          dimension:
            label: 'BA Site'
      - name: unique_id
        description: "Primary Key"
        meta:
          dimension:
            format: id
            hidden: true
      - name: product_id
      - name: variant_product_id
      - name: sku
        meta:
          dimension:
            label: 'Parent SKU'
      - name: variant_sku
        meta:
          dimension:
            label: 'Variant SKU'
      - name: category_name
      - name: category_id
      - name: sale_start_at
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
            sql: 'if(products_sales.ba_site = "FR",datetime(products_sales.sale_start_at, "Europe/Paris"),datetime(products_sales.sale_start_at, "Europe/London"))'
      - name: sale_end_at
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
            sql: 'if(products_sales.ba_site = "FR",datetime(products_sales.sale_end_at, "Europe/Paris"),datetime(products_sales.sale_end_at, "Europe/London"))'
      - name: variant_sku_per_sku_per_sale_number
          
  - name: stock_file
    description: ""
    meta:
      group_label: 'Products'
    columns:
      - name: ba_site_child_entity_id
        description: "Primary Key"
        tests:
          - unique
          - not_null
        meta:
          dimension:
            format: id
          metrics:
            count_refunds_metric:
              label: 'Total number of entity id'
              type: count_distinct
              description: "Number of entity id"
              hidden: false
              round: 0 
      - name: ba_site
      - name: child_entity_id
        description: "Primary Key at site level"
      - name: child_sku
        description: "child sku, nullable"
      - name: min_qty
        description: "Quantity min, nullable"
      - name: qty
        description: "Quantity, nullable"
        tests:
          - stock_file_qty 
        meta:
          metrics:
            total_stock_qty:
              type: sum
      - name: stock_kettering
        meta:
          metrics:
            total_stock_kettering:
              type: sum
            total_ttl_flash_kettering:
              type: sum
              sql: '${special_price}*${stock_kettering}'
            total_ttl_cost_kettering:
              type: sum
              sql: '${cost}*${stock_kettering}'
      - name: stock_kettering_allocated
        meta:
          metrics:
            total_stock_kettering_allocated:
              type: sum
              label: 'Allocated Stock Qty'
      - name: stock_kettering_unsellable_good
        meta:
          metrics:
            total_stock_kettering_unsellable_good:
              type: sum
              label: 'Unsellable Location Stock Qty'
      - name: stock_kettering_unsellable_bad
        meta:
          metrics:
            total_stock_kettering_unsellable_bad:
              type: sum
              label: 'Unsellable Damaged Stock Qty'
      - name: image_value
        description: "Image value, nullable"
      - name: name
        description: "name, nullable"
      - name: value
        description: "Base adjustement negative, nullable"
      - name: suplier_id
        description: "suplier id, nullable"
        meta:
          dimension:
            format: id
      - name: brand
        description: "Brand, nullable"
      - name: country_of_manufacture
        description: "Country of manufacture, nullable"
      - name: cost
        description: "cost, nullable"
        meta:
          metrics:
            total_stock_cost:
              type: sum
              sql: '${cost}*${qty}'
              round: 2
      - name: parent_gender
        description: "Parent gender, nullable"
      - name: simple_gender
        description: "Gender of the simple item, nullable"
      - name: simple_product_type
        description: "Simple product type, nullable"
      - name: parent_product_type
        description: "Parent product type, nullable"
      - name: size
        description: "Size, nullable"
      - name: colour
        description: "Colour, nullable"
      - name: price
        description: "Price, nullable"
      - name: special_price
        description: "Special price, nullable"
        meta:
          metrics:
            total_stock_special_price:
              type: sum
              sql: '${special_price}*${qty}'
              label: 'Total Flash Price'
              round: 2
      - name: outlet_price
        description: "Outlet price, nullable"
      - name: outlet_category
        description: "Outlet category, nullable"
      - name: department_type
      - name: canUseForWHSale
        description: "Can use for warehouse sale flag, nullable"
        meta:
          dimension:
            label: 'Can Use For WH Sale'
      - name: barcode
        description: "Barcode, nullable"
      - name: nego
        description: "Nego number, nullable"
      - name: buyer_id
        description: "Buyer id, nullable"
        meta:
          dimension:
            format: id
      - name: buyer
        description: "Buyer, nullable"
      - name: level_1
        description: "Level 1 of categories"
      - name: level_2
        description: "Level 2 of categories"
      - name: level_3
        description: "Level 3 of categories"
      - name: parent_category
        description: "Parent category"
      - name: flashsale_category
        description: "Flash sale category"
      - name: supplier_name
        description: "Supplier name"
      - name: child_parent_sku
        description: "Child parent SKU"
      - name: last_stock_delivery_date
      - name: child_parent_sku_age_days
        meta:
          dimension:
            sql: 'date_diff(current_date, ${last_stock_delivery_date}, day)'
      - name: sku_avg_weighted_age
        meta:
          dimension:
            label: 'Average Weighted Age (days)'
      - name: child_parent_sku_age_bucket
        meta:
          dimension:
            sql: > 
              case 
                when ifnull(${sku_avg_weighted_age},date_diff(current_date, ${last_stock_delivery_date}, day)) > 365 then 'Over 12 Months'
                when ifnull(${sku_avg_weighted_age},date_diff(current_date, ${last_stock_delivery_date}, day)) > 274 then '10 - 12 Months'
                when ifnull(${sku_avg_weighted_age},date_diff(current_date, ${last_stock_delivery_date}, day)) > 180 then '7 - 9 Months'
                when ifnull(${sku_avg_weighted_age},date_diff(current_date, ${last_stock_delivery_date}, day)) > 90 then '4 - 6 Months'
                when ifnull(${sku_avg_weighted_age},date_diff(current_date, ${last_stock_delivery_date}, day)) > 0 then '0 - 3 Months'
                else 'No Deliveries'
              end
      - name: category
        description: "Category as defined by buyers"
      - name: tax
        description: "Tax percentage"
        meta:
          dimension:
            label: 'Tax Rate'

  - name: stock_file_daily
    description: ""
    meta:
      group_label: 'Products'
    columns:
      - name: stock_file_date
        meta:
          dimension:
            label: 'Stock File Date'
            description: 'Stock file at specified date'
      - name: processed_at
        meta:
          dimension:
            hidden: true
      - name: ba_site_child_entity_id
        description: "Primary Key"
        tests:
          - not_null
        meta:
          dimension:
            format: id
          metrics:
            count_refunds_metric:
              label: 'Total number of entity id'
              type: count_distinct
              description: "Number of entity id"
              hidden: false
              round: 0 
      - name: ba_site
      - name: child_entity_id
        description: "Primary Key at site level"
      - name: child_sku
        description: "child sku, nullable"
      - name: min_qty
        description: "Quantity min, nullable"
      - name: qty
        description: "Quantity, nullable"
      - name: stock_kettering
        meta:
          metrics:
            total_stock_kettering:
              type: sum
            total_ttl_flash_kettering:
              type: sum
              sql: '${special_price}*${stock_kettering}'
            total_ttl_cost_kettering:
              type: sum
              sql: '${cost}*${stock_kettering}'
      - name: stock_kettering_allocated
        meta:
          metrics:
            total_stock_kettering_allocated:
              type: sum
              label: 'Allocated Stock Qty'
      - name: stock_kettering_unsellable_good
        meta:
          metrics:
            total_stock_kettering_unsellable_good:
              type: sum
              label: 'Unsellable Location Stock Qty'
      - name: stock_kettering_unsellable_bad
        meta:
          metrics:
            total_stock_kettering_unsellable_bad:
              type: sum
              label: 'Unsellable Damaged Stock Qty'
      - name: image_value
        description: "Image value, nullable"
      - name: name
        description: "name, nullable"
      - name: value
        description: "Base adjustement negative, nullable"
      - name: suplier_id
        description: "suplier id, nullable"
        meta:
          dimension:
            format: id
      - name: brand
        description: "Brand, nullable"
      - name: country_of_manufacture
        description: "Country of manufacture, nullable"
      - name: cost
        description: "cost, nullable"
      - name: parent_gender
        description: "Parent gender, nullable"
      - name: simple_gender
        description: "Gender of the simple item, nullable"
      - name: simple_product_type
        description: "Simple product type, nullable"
      - name: parent_product_type
        description: "Parent product type, nullable"
      - name: size
        description: "Size, nullable"
      - name: colour
        description: "Colour, nullable"
      - name: price
        description: "Price, nullable"
      - name: special_price
        description: "Special price, nullable"
      - name: outlet_price
        description: "Outlet price, nullable"
      - name: outlet_category
        description: "Outlet category, nullable"
      - name: department_type
      - name: canUseForWHSale
        description: "Can use for warehouse sale flag, nullable"
        meta:
          dimension:
            label: 'Can Use For WH Sale'
      - name: barcode
        description: "Barcode, nullable"
      - name: nego
        description: "Nego number, nullable"
      - name: buyer_id
        description: "Buyer id, nullable"
        meta:
          dimension:
            format: id
      - name: buyer
        description: "Buyer, nullable"
      - name: level_1
        description: "Level 1 of categories"
      - name: level_2
        description: "Level 2 of categories"
      - name: level_3
        description: "Level 3 of categories"
      - name: parent_category
        description: "Parent category"
      - name: flashsale_category
        description: "Flash sale category"
      - name: supplier_name
        description: "Supplier name"
      - name: child_parent_sku
        description: "Child parent SKU"
      - name: last_stock_delivery_date
        meta:
          dimension:
            type: date
            time_intervals: ['DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: child_parent_sku_age_days
        meta:
          dimension:
            sql: 'date_diff(${stock_file_date}, ${last_stock_delivery_date}, day)'
      - name: sku_avg_weighted_age
        meta:
          dimension:
            label: 'Average Weighted Age (days)'
      - name: child_parent_sku_age_bucket
        meta:
          dimension:
            sql: > 
              case 
                when ifnull(${sku_avg_weighted_age},date_diff(${stock_file_date}, ${last_stock_delivery_date}, day)) > 365 then 'Over 12 Months'
                when ifnull(${sku_avg_weighted_age},date_diff(${stock_file_date}, ${last_stock_delivery_date}, day)) > 274 then '10 - 12 Months'
                when ifnull(${sku_avg_weighted_age},date_diff(${stock_file_date}, ${last_stock_delivery_date}, day)) > 180 then '7 - 9 Months'
                when ifnull(${sku_avg_weighted_age},date_diff(${stock_file_date}, ${last_stock_delivery_date}, day)) > 90 then '4 - 6 Months'
                when ifnull(${sku_avg_weighted_age},date_diff(${stock_file_date}, ${last_stock_delivery_date}, day)) > 0 then '0 - 3 Months'
                else 'No Deliveries'
              end
      - name: category
        description: "Category as defined by buyers"
      - name: tax
        description: "Tax percentage"
        meta:
          dimension:
            label: 'Tax Rate'
            
  - name: catalog_category_flat_store_1_enriched
    description: ""
    columns:
      - name: ba_site
      - name: entity_id
        data_type: <integer>
        description: "Primary key"
      - name: parent_id
        data_type: <integer>
        description: "Parent id"
      - name: created_at
        data_type: <timestamp>
        description: "Create date"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: updated_at
        data_type: <integer>
        description: "Update date"
      - name: path
        data_type: <string>
        description: "Category path"
      - name: position
        data_type: <integer>
        description: "Position"
      - name: level
        data_type: <integer>
        description: "Level"
      - name: children_count
        data_type: <integer>
        description: "Children count"
      - name: store_id
        data_type: <integer>
        description: "Store id"
      - name: allow_google
        data_type: <integer>
        description: "Allow google"
      - name: all_children
        data_type: <string>
        description: "All children"
      - name: approved_by
        data_type: <string>
        description: "Approved by"
      - name: available_sort_by
        data_type: <string>
        description: "Available Product Listing Sort By"
      - name: brand_attribution
        data_type: <varchar>
        description: "Brand Attribution"
      - name: category_brand_title
        data_type: <string>
        description: "Brands Short Name"
      - name: category_landingpagetype
        data_type: <integer>
        description: "Marketing Landing Pages Selection"
      - name: category_menu_type
        data_type: <integer>
        description: "Category Menu Type"
      - name: category_product_brand
        data_type: <integer>
        description: "Product Brands"
      - name: category_product_gender
        data_type: <integer>
        description: "Product Brands"
      - name: category_product_type
        data_type: <string>
        description: "Product Type"
      - name: children
        data_type: <string>
        description: "Children"
      - name: customer_segments
        data_type: <string>
        description: "Customer Segments"
      - name: custom_apply_to_products
        data_type: <integer>
        description: "Apply To Products"
      - name: custom_design
        data_type: <string>
        description: "Custom Design"
      - name: custom_design_from
        data_type: <timestamp>
        description: "Active From"
      - name: custom_design_to
        data_type: <timestamp>
        description: "Active To"
      - name: custom_layout_update
        data_type: <string>
        description: "Custom Layout Update"
      - name: custom_use_parent_settings
        data_type: <integer>
        description: "Use Parent Category Settings"
      - name: default_sort_by
        data_type: <string>
        description: "Default Product Listing Sort By"
      - name: delivery_info
        data_type: <string>
        description: "Delivery Information"
      - name: description
        data_type: <string>
        description: "Description"
      - name: display_brand_products
        data_type: <integer>
        description: "Display Products On Brand Page"
      - name: display_mode
        data_type: <string>
        description: "Display Mode"
      - name: emarsys_include_in_rss
        data_type: <integer>
        description: "Emarsys Include in Rss"
      - name: emarsys_rss_order
        data_type: <integer>
        description: "Emarsys Rss Order"
      - name: extra_restrictions
        data_type: <integer>
        description: "Sale Restrictions"
      - name: filter_price_range
        data_type: <decimal>
        description: "Layered Navigation Price Step"
      - name: flashsale_promotional_banner
        data_type: <string>
        description: "Promotional banner image"
      - name: full_description
        data_type: <string>
        description: "Full Description"
      - name: gender_attribution
        data_type: <integer>
        description: "Gender Attribution"
      - name: group_tags
        data_type: <string>
        description: "Category Tags"
      - name: image
        data_type: <string>
        description: "Image"
      - name: include_in_menu
        data_type: <integer>
        description: "Include in Navigation Menu"
      - name: is_active
        data_type: <integer>
        description: "Is Active"
      - name: is_anchor
        data_type: <integer>
        description: "Is Anchor"
      - name: landing_page
        data_type: <integer>
        description: "CMS Block"
      - name: meta_description
        data_type: <string>
        description: "Meta Description"
      - name: meta_keywords
        data_type: <string>
        description: "Meta Keywords"
      - name: meta_title
        data_type: <string>
        description: "Page Title"
      - name: name
        data_type: <string>
        description: "Name"
      - name: outlet_landing_image
        data_type: <string>
        description: "Outlet landing image"
      - name: outlet_slider_content
        data_type: <string>
        description: "Slider Content"
      - name: outlet_slider_order
        data_type: <integer>
        description: "Outlet Slider Order"
      - name: page_layout
        data_type: <string>
        description: "Page Layout"
      - name: path_in_store
        data_type: <string>
        description: "Path In Store"
      - name: preview_mode
        data_type: <integer>
        description: "Category in preview mode"
      - name: private_sales_link
        data_type: <string>
        description: "Private Sales Link"
      - name: promotional_banner_link
        data_type: <string>
        description: "Promotional banner link"
      - name: promotional_date
        data_type: <timestamp>
        description: "Promotional date"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: promotion_date
        data_type: <timestamp>
        description: "Sorting date"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: promotion_options
        data_type: <string>
        description: "Promotion Options"
      - name: promo_text
        data_type: <string>
        description: "Promotion Text"
      - name: sale_end
        data_type: <timestamp>
        description: "Sale End"
      - name: sale_start
        data_type: <timestamp>
        description: "Sale Start"
      - name: sale_type
        data_type: <integer>
        description: "Sale type"
      - name: show_out_of_stock
        data_type: <integer>
        description: "Show out of stock"
      - name: standard_image
        data_type: <string>
        description: "Standard Image"
      - name: tagline
        data_type: <string>
        description: "Tag line"
      - name: thumbnail
        data_type: <string>
        description: "Thumbnail Image"
      - name: umm_cat_label
        data_type: <string>
        description: "Category Label"
      - name: umm_cat_target
        data_type: <string>
        description: "Custom URL"
      - name: umm_dd_blocks
        data_type: <string>
        description: "Category Blocks"
      - name: umm_dd_columns
        data_type: <integer>
        description: "Number of Columns With Subcategories"
      - name: umm_dd_proportions
        data_type: <string>
        description: "Drop-down Content Proportions"
      - name: umm_dd_type
        data_type: <string>
        description: "Submenu Type"
      - name: umm_dd_width
        data_type: <string>
        description: "Drop-down Width"
      - name: url_key
        data_type: <string>
        description: "URL Key"
      - name: url_path
        data_type: <string>
        description: "Url Path"
      - name: path_name
        data_type: <string>
        description: "Path name formatted"

  - name: purchase_order
    description: ""
    columns:
      - name: ba_site
      - name: po_id
        description: "ID of the PO"
        meta:
          dimension:
            format: id
      - name: po_item_id
        description: "ID of the line of the PO"
        meta:
          dimension:
            format: id
      - name: product_id
        description: "Product ID"
        meta:
          dimension:
            format: id
      - name: SKU
        description: "SKU"
      - name: reference
        description: "Reference, nullable"
      - name: simple_name
        description: "Name of the simple product"
      - name: brand
        description: "brand"
      - name: colour
        description: "Colour"
      - name: web_size
        description: "Web size"
      - name: supplier_size
        description: "Supplier size"
      - name: cost
        description: "Cost"
      - name: cost_gbp
        description: "Cost GBP"
      - name: rrp
        description: "RRP"
      - name: tax_rate
        description: "Tax rate"
      - name: tax_code
        description: "Tax code"
      - name: barcode
        description: "Barcode"
      - name: commodity_code
        description: "Commodity code"
      - name: category
        description: "Category"
      - name: sub_category
        description: "Sub category"
      - name: sub_sub_category
        description: "Sub sub category"
      - name: image
        description: "Image"
      - name: pack_size
        description: "Pack size"
      - name: to_order
        description: "To order"
      - name: to_order_original
        description: "To order original"
      - name: negotiation_id
        description: "Negotiation ID"
      - name: poi_updated
        description: "Updated date of the POI"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
            sql: 'if(purchase_order.ba_site = "FR",datetime(purchase_order.poi_updated, "Europe/Paris"),datetime(purchase_order.poi_updated, "Europe/London"))'
      - name: po_created
        description: "Created date of the PO"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
            sql: 'if(purchase_order.ba_site = "FR",datetime(purchase_order.po_created, "Europe/Paris"),datetime(purchase_order.po_created, "Europe/London"))'
      - name: po_updated
        description: "Update date of the PO"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
            sql: 'if(purchase_order.ba_site = "FR",datetime(purchase_order.po_updated, "Europe/Paris"),datetime(purchase_order.po_updated, "Europe/London"))'          
      - name: po_status
        description: "Status of the po"
      - name: sap_ref
        description: "SAP ref"
      - name: sap_message
        description: "SAP message"
      - name: po_delivery
        description: "Delivery date of the PO"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
            sql: 'if(purchase_order.ba_site = "FR",datetime(purchase_order.po_delivery, "Europe/Paris"),datetime(purchase_order.po_delivery, "Europe/London"))'           
      - name: po_date_exported
        description: "Export date of the PO"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
            sql: 'if(purchase_order.ba_site = "FR",datetime(purchase_order.po_date_exported, "Europe/Paris"),datetime(purchase_order.po_date_exported, "Europe/London"))'        
      - name: products_in_wh_b
        description: "Products in WH B"
      - name: products_export_process_id
        description: "Products export process id"
      - name: purchase_order_export_process_id
        description: "Purchase order export process id"
      - name: purchase_order_in_wh_b
        description: "PO in WH B"
      - name: grn_id
        description: "GRN Id"
        meta:
          dimension:
            format: id
      - name: grn_date
        description: grn_date
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
            sql: 'if(purchase_order.ba_site = "FR",datetime(purchase_order.grn_date, "Europe/Paris"),datetime(purchase_order.grn_date, "Europe/London"))'        
      - name: magento_process_id
        description: "Magento process id"
        meta:
          dimension:
            format: id
      - name: grn_item_id
        description: "GRN item id"
        meta:
          dimension:
            format: id
      - name: in_sap
        description: "In SAP"
      - name: grn_delivery_number
        description: "Delivery number"
      - name: grn_delivery_date
        description: "GRN Delivery"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
            sql: 'if(purchase_order.ba_site = "FR",datetime(purchase_order.grn_delivery_date, "Europe/Paris"),datetime(purchase_order.grn_delivery_date, "Europe/London"))'       
      - name: stock_type_ss
        description: "Stock type SS"
      - name: stock_type_qc
        description: "Stock type QC"
      - name: nego_updated
        description: "Nego update date"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
            sql: 'if(purchase_order.ba_site = "FR",datetime(purchase_order.nego_updated, "Europe/Paris"),datetime(purchase_order.nego_updated, "Europe/London"))'           
      - name: nego_type
        description: "Negotiation type"
      - name: supplier
        description: "Supplier"
      - name: supplier_id
        description: "Supplier ID"
      - name: supplier_name
        description: "Supplier Name"
      - name: nego_currency
        description: "Nego currency"         
      - name: buyer
        description: "Buyer"    
      - name: department
        description: "Department"
      - name: size
        description: "Size"
      - name: price
        description: "Price"
      - name: qty
        description: "Quantity"
      - name: nego_ordered
        description: "Ordered qty linked to nego"
      - name: to_order
        description: "To order qty linked to nego"
      - name: qty_exported
        description: "Quantity exported"

  - name: stock_age
    description: ""
    meta:
      group_label: 'Products'
      joins:
        - join: stock_file
          sql_on: ${stock_age.sku} = ${stock_file.child_sku} and ${stock_age.ba_site} = ${stock_file.ba_site}
          
    columns:
      - name: logged_date
        meta:
          dimension:
            label: 'Current Date'
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: sku
        meta:
          dimension:
            label: 'Sku'
      - name: ba_site
        meta:
          dimension:
            label: 'BA Site'
      - name: qty_split
        meta:
          dimension:
            hidden: true
          metrics:
            stock_qty_metric:
              label: 'Stock Qty'
              type: sum
              description: 'Stock Qty'
      - name: date_arrived
        meta:
          dimension:
            label: 'Arrived Date'
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: days_old
        meta:
          dimension:
            label: 'Days Old'
      - name: unit_cost
        meta:
          dimension:
            type: number
            label: 'Unit Cost'
          metrics:
            stock_value_metric:
              label: 'Stock Value'
              type: sum
              description: 'Sum of Stock Value'
              sql: "${unit_cost}*${qty_split}"
              round: 2
      - name: age_bucket
        meta:
          dimension:
            label: 'Age Bucket'
      - name: sku_avg_weighted_age
        meta:
          dimension:
            label: 'Average Weighted Age'
            description: 'The Average Age of the Sku weighted to qty arriving at different times'
          metrics:
            avg_weighted_age_metric:
              label: 'Average Weighted Age Metric'
              type: average
              description: 'The average weighted age when comparing multiple skus'
              round: 2
      - name: age_bucket_sort_order
        meta:
          dimension:
            hidden: true
          metrics:
            age_bucket_sort:
              label: 'Age Bucket Sort'
              type: min
              description: 'Integer to sort age buckets for reporting'
  
  - name: stock_age_daily
    description: ""
    meta:
      group_label: 'Products'
      joins:
        - join: stock_file_daily
          sql_on: ${stock_age_daily.logged_date} = ${stock_file_daily.stock_file_date} and ${stock_age_daily.sku} = ${stock_file_daily.child_sku} and ${stock_age_daily.ba_site} = ${stock_file_daily.ba_site}

    columns:
      - name: processed_at
      - name: logged_date
        meta:
          dimension:
            label: 'Logged Date'
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: sku
        meta:
          dimension:
            label: 'Sku'
      - name: ba_site
        meta:
          dimension:
            label: 'BA Site'
      - name: qty_split
        meta:
          dimension:
            hidden: true
          metrics:
            stock_qty_metric:
              label: 'Stock Qty'
              type: sum
              description: 'Stock Qty'
      - name: date_arrived
        meta:
          dimension:
            label: 'Arrived Date'
            type: timestamp
            time_intervals: ['RAW', 'SECOND', 'MINUTE', 'HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER', 'YEAR', 'DAY_OF_WEEK_NAME', 'MONTH_NAME', 'QUARTER_NAME']
      - name: days_old
        meta:
          dimension:
            label: 'Days Old'
      - name: unit_cost
        meta:
          dimension:
            type: number
            label: 'Unit Cost'
          metrics:
            stock_value_metric:
              label: 'Stock Value'
              type: sum
              description: 'Sum of Stock Value'
              sql: "${unit_cost}*${qty_split}"
              round: 2
      - name: age_bucket
        meta:
          dimension:
            label: 'Age Bucket'
      - name: sku_avg_weighted_age
        meta:
          dimension:
            label: 'Average Weighted Age'
            description: 'The Average Age of the Sku weighted to qty arriving at different times'
          metrics:
            avg_weighted_age_metric:
              label: 'Average Weighted Age Metric'
              type: average
              description: 'The average weighted age when comparing multiple skus'
              round: 2
      - name: age_bucket_sort_order
        meta:
          dimension:
            hidden: true
          metrics:
            age_bucket_sort:
              label: 'Age Bucket Sort'
              type: min
              description: 'Integer to sort age buckets for reporting'