version: 2

models:
  
  - name: zendesk_tickets_detailed
    description: "A detailed view of all tickets for zendesk"
    columns:
      - name: id
        description: "Primary key"
        tests:
          - unique
          - not_null
        meta:
          dimension:
            format: id
          metrics:
            total_zendesk_tickets:
              label: 'Total number of tickets from zendesk'
              type: count_distinct
              description: "Number of tickets in Zendesk"
              hidden: false
              round: 0      
      - name: created_at
        description: "created_at"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER']
            sql: 'datetime(zendesk_tickets_detailed.created_at, "Europe/London")'            
      - name: description
        description: "description"
      - name: due_at
        description: "Due date of the ticket"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER']     
            sql: 'datetime(zendesk_tickets_detailed.due_at, "Europe/London")'           
      - name: is_public
        description: "is_public"
      - name: merged_ticket_ids
        description: "Ids of tickets merged"
      - name: status
        description: "Status of the ticket"
      - name: subject
        description: "Subject of the ticket"
      - name: updated_at
        description: "Update date"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER']   
            sql: 'datetime(zendesk_tickets_detailed.updated_at, "Europe/London")'             
      - name: type
        description: "Type"
      - name: URL
        description: "URL"
      - name: via_channel
        description: "Channel the ticket is coming from"
      - name: via_source_rel
        description: "Source relative to the channel"
      - name: phone_ticket
        description: "1 when it's a phone ticket, 0 otherwise"
        meta:
          metrics:
            total_zendesk_phone_tickets:
              label: 'Total number of tickets coming from calls from zendesk'
              type: sum
              description: "Number of tickets coming from calls in Zendesk"
              hidden: false
              round: 0      
      - name: chat_ticket
        description: "1 when it's a chat ticket, 0 otherwise"
        meta:
          metrics:
            total_zendesk_chat_tickets:
              label: 'Total number of tickets coming from chat from zendesk'
              type: sum
              description: "Number of tickets coming from chat in Zendesk"
              hidden: false
              round: 0      
      - name: web_email_ticket
        description: "1 when it's a web or email ticket, 0 otherwise"
        meta:
          metrics:
            total_zendesk_web_email_tickets:
              label: 'Total number of tickets coming from web or email from zendesk'
              type: sum
              description: "Number of tickets coming from web or email in Zendesk"
              hidden: false
              round: 0      
      - name: web_ticket
        description: "1 when it's a phone ticket, 0 otherwise"
        meta:
          metrics:
            total_zendesk_web_tickets:
              label: 'Total number of tickets coming from web from zendesk'
              type: sum
              description: "Number of tickets coming from web in Zendesk"
              hidden: false
              round: 0      
      - name: email_ticket
        description: "1 when it's a phone ticket, 0 otherwise"
        meta:
          metrics:
            total_zendesk_email_tickets:
              label: 'Total number of tickets coming from email from zendesk'
              type: sum
              description: "Number of tickets coming from email in Zendesk"
              hidden: false
              round: 0      
      - name: custom_carrier
        description: "carrier"
      - name: custom_client_contact_reason_no_order
        description: "Client contact reason no order"
      - name: custom_client_contact_reason_order
        description: "custom_client_contact_reason_order"
      - name: custom_contact_reason
        description: "custom_contact_reason"
      - name: custom_coupon_code
        description: "custom_coupon_code"
      - name: custom_needs_senior_help
        description: "custom_needs_senior_help"
      - name: custom_order_id
        description: "custom_order_id"
      - name: custom_order_number
        description: "custom_order_number"
      - name: custom_order_related
        description: "custom_order_related"
      - name: custom_product_issue_type
        description: "custom_product_issue_type"
      - name: custom_shipping_issue_type
        description: "custom_shipping_issue_type"
      - name: custom_solution
        description: "custom_solution"
      - name: custom_status_id
        description: "custom_status_id"
      - name: custom_tracking_
        description: "custom_tracking_"
            
  - name: zendesk_call_metric
    columns:
      - name: id
        data_type: <integer>
        description: "Primary key"
        meta:
          dimension:
            format: id
          metrics:
            ticket_count:
              label: 'Number of tickets coming from phone'
              type: count_distinct
              description: "Number of tickets coming from phone"
              hidden: false
              round: 0      
      - name: agent_id
        data_type: <integer>
        description: "Agent ID"
        meta:
          dimension:
            format: id
      - name: call_charge
        data_type: <string>
        description: "Call charge"
      - name: call_group_id
        data_type: <integer>
        description: "Call group ID"
        meta:
          dimension:
            format: id
      - name: call_recording_consent
        data_type: <string>
        description: "Call recording consent"
      - name: call_recording_consent_action
        data_type: <string>
        description: "Call recording consent action"
      - name: call_recording_consent_keypress
        data_type: <string>
        description: "Call recording consent keypress"
      - name: callback
        data_type: <string>
        description: "Callback"
      - name: callback_source
        data_type: <string>
        description: "Callback source"
      - name: completion_status
        data_type: <string>
        description: "Completion status"
      - name: consultation_time
        data_type: <integer>
        description: "Consultation time"
      - name: created_at
        data_type: <timestamp>
        description: "Created at"
      - name: customer_requested_voicemail
        data_type: <string>
        description: "Customer requested voicemail"
      - name: default_group
        data_type: <string>
        description: "Default group"
      - name: direction
        data_type: <string>
        description: "Direction"
      - name: duration
        data_type: <integer>
        description: "Duration"
      - name: exceeded_queue_wait_time
        data_type: <string>
        description: "Exceeded queue wait time"
      - name: hold_time
        data_type: <integer>
        description: "Hold time"
      - name: ivr_action
        data_type: <string>
        description: "IVR action"
      - name: ivr_destination_group_name
        data_type: <string>
        description: "IVR destination group name"
      - name: ivr_hops
        data_type: <integer>
        description: "IVR hops"
      - name: ivr_routed_to
        data_type: <string>
        description: "IVR routed to"
      - name: ivr_time_spent
        data_type: <integer>
        description: "IVR time spent"
      - name: minutes_billed
        data_type: <integer>
        description: "Minutes billed"
      - name: not_recording_time
        data_type: <integer>
        description: "Not recording time"
      - name: outside_business_hours
        data_type: <string>
        description: "Outside business hours"
      - name: overflowed
        data_type: <string>
        description: "Overflowed"
      - name: overflowed_to
        data_type: <string>
        description: "Overflowed to"
      - name: phone_number
        data_type: <string>
        description: "Phone number"
      - name: phone_number_id
        data_type: <integer>
        description: "Phone number id"
      - name: quality_issues
        data_type: <string>
        description: "Quality issues"
      - name: recording_control_interactions
        data_type: <integer>
        description: "Recording control interactions"
      - name: recording_time
        data_type: <integer>
        description: "Recording time"
      - name: talk_time
        data_type: <integer>
        description: "Talk time"
      - name: ticket_id
        data_type: <integer>
        description: "Ticket id"
        meta:
          dimension:
            format: id
      - name: time_to_answer
        data_type: <integer>
        description: "Time to answer"
      - name: updated_at
        data_type: <timestamp>
        description: "Update date"
      - name: voicemail
        data_type: <string>
        description: "Voicemail"
      - name: wait_time
        data_type: <integer>
        description: "Wait time"
      - name: wrap_up_time
        data_type: <integer>
        description: "Wrap up time"

  - name: daily_zendesk_call
    columns:
      - name: created_at
        description: "created_at"
        meta:
          dimension:
            type: date
            time_intervals: ['DAY', 'WEEK', 'MONTH', 'QUARTER']
            sql: 'date(zendesk_call_metric.created_at, "Europe/London")'             
      - name: number_of_calls
        description: "Number of calls"
        meta:
          metrics:
            total_zendesk_calls:
              label: 'Total number of calls from zendesk'
              type: sum
              description: "Number of calls from Zendesk"
              hidden: false
              round: 0      
      - name: inbound_calls
        description: "Number of inbound calls"
        meta:
          metrics:
            total_zendesk_inbound_calls:
              label: 'Total number of inbound calls from zendesk'
              type: sum
              description: "Number of inbound calls from Zendesk"
              hidden: false
              round: 0      
      - name: outbound_calls
        description: "Number of outbound calls"
        meta:
          metrics:
            total_zendesk_inbound_calls:
              label: 'Total number of outbound calls from zendesk'
              type: sum
              description: "Number of outbound calls from Zendesk"
              hidden: false
              round: 0      
      - name: completed_calls
        description: "Number of completed calls"
        meta:
          metrics:
            total_zendesk_completed_calls:
              label: 'Total number of completed calls from zendesk'
              type: sum
              description: "Number of completed calls from Zendesk"
              hidden: false
              round: 0      
      - name: abandoned_calls
        description: "Number of abandoned calls"
        meta:
          metrics:
            total_zendesk_abandoned_calls:
              label: 'Total number of abandoned calls from zendesk'
              type: sum
              description: "Number of abandoned calls from Zendesk"
              hidden: false
              round: 0      
      - name: call_duration
        description: "Sum of all calls duration in HH:mm:SS format"
      - name: inbound_duration
        description: "Sum of inbound calls duration in HH:mm:SS format"
      - name: outbound_duration
        description: "Sum of outbound calls duration in HH:mm:SS format"
      - name: completed_duration
        description: "Sum of completed calls duration in HH:mm:SS format"
      - name: abandoned_duration
        description: "Sum of abandoned calls duration in HH:mm:SS format"
      - name: avg_call_duration
        description: "Avg of all calls duration in HH:mm:SS format"
      - name: avg_inbound_duration
        description: "Avg of inbound calls duration in HH:mm:SS format"
      - name: avg_outbound_duration
        description: "Avg of outbound calls duration in HH:mm:SS format"
      - name: avg_completed_duration
        description: "Avg of completed calls duration in HH:mm:SS format"
      - name: avg_abandoned_duration
        description: "Avg of abandoned calls duration in HH:mm:SS format"
      - name: max_call_duration
        description: "Max of all calls duration in HH:mm:SS format"
      - name: max_inbound_duration
        description: "Max of inbound calls duration in HH:mm:SS format"
      - name: max_outbound_duration
        description: "Max of outbound calls duration in HH:mm:SS format"
      - name: max_completed_duration
        description: "Max of completed calls duration in HH:mm:SS format"
      - name: max_abandoned_duration
        description: "Max of abandoned calls duration in HH:mm:SS format"