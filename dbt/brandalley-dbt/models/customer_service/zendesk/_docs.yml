version: 2

models:
  
  - name: zendesk_tickets_detailed
    description: "A detailed view of all tickets for zendesk"
    columns:
      - name: id
        description: "Primary key"
        tests:
          - unique
          - not_null
        meta:
          dimension:
            format: id
          metrics:
            total_zendesk_tickets:
              label: 'Total number of tickets from zendesk'
              type: count_distinct
              description: "Number of tickets in Zendesk"
              hidden: false
              round: 0      
      - name: created_at
        description: "created_at"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER']
            sql: 'datetime(zendesk_tickets_detailed.created_at, "Europe/London")'            
      - name: description
        description: "description"
      - name: due_at
        description: "Due date of the ticket"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER']     
            sql: 'datetime(zendesk_tickets_detailed.due_at, "Europe/London")'           
      - name: is_public
        description: "is_public"
      - name: merged_ticket_ids
        description: "Ids of tickets merged"
      - name: status
        description: "Status of the ticket"
      - name: subject
        description: "Subject of the ticket"
      - name: updated_at
        description: "Update date"
        meta:
          dimension:
            type: timestamp
            time_intervals: ['HOUR', 'DAY', 'WEEK', 'MONTH', 'QUARTER']   
            sql: 'datetime(zendesk_tickets_detailed.updated_at, "Europe/London")'             
      - name: type
        description: "Type"
      - name: URL
        description: "URL"
      - name: via_channel
        description: "Channel the ticket is coming from"
      - name: via_source_rel
        description: "Source relative to the channel"
      - name: phone_ticket
        description: "1 when it's a phone ticket, 0 otherwise"
        meta:
          metrics:
            total_zendesk_phone_tickets:
              label: 'Total number of tickets coming from calls from zendesk'
              type: sum
              description: "Number of tickets coming from calls in Zendesk"
              hidden: false
              round: 0      
      - name: chat_ticket
        description: "1 when it's a chat ticket, 0 otherwise"
        meta:
          metrics:
            total_zendesk_chat_tickets:
              label: 'Total number of tickets coming from chat from zendesk'
              type: sum
              description: "Number of tickets coming from chat in Zendesk"
              hidden: false
              round: 0      
      - name: web_email_ticket
        description: "1 when it's a web or email ticket, 0 otherwise"
        meta:
          metrics:
            total_zendesk_web_email_tickets:
              label: 'Total number of tickets coming from web or email from zendesk'
              type: sum
              description: "Number of tickets coming from web or email in Zendesk"
              hidden: false
              round: 0      
      - name: web_ticket
        description: "1 when it's a phone ticket, 0 otherwise"
        meta:
          metrics:
            total_zendesk_web_tickets:
              label: 'Total number of tickets coming from web from zendesk'
              type: sum
              description: "Number of tickets coming from web in Zendesk"
              hidden: false
              round: 0      
      - name: email_ticket
        description: "1 when it's a phone ticket, 0 otherwise"
        meta:
          metrics:
            total_zendesk_email_tickets:
              label: 'Total number of tickets coming from email from zendesk'
              type: sum
              description: "Number of tickets coming from email in Zendesk"
              hidden: false
              round: 0      
      - name: custom_carrier
        description: "carrier"
      - name: custom_client_contact_reason_no_order
        description: "Client contact reason no order"
      - name: custom_client_contact_reason_order
        description: "custom_client_contact_reason_order"
      - name: custom_contact_reason
        description: "custom_contact_reason"
      - name: custom_coupon_code
        description: "custom_coupon_code"
      - name: custom_needs_senior_help
        description: "custom_needs_senior_help"
      - name: custom_order_id
        description: "custom_order_id"
      - name: custom_order_number
        description: "custom_order_number"
      - name: custom_order_related
        description: "custom_order_related"
      - name: custom_product_issue_type
        description: "custom_product_issue_type"
      - name: custom_shipping_issue_type
        description: "custom_shipping_issue_type"
      - name: custom_solution
        description: "custom_solution"
      - name: custom_status_id
        description: "custom_status_id"
      - name: custom_tracking_
        description: "custom_tracking_"
      - name: custom_main_contact_reason
        description: "L1 contact reason"
        meta:
          dimension:
            type: string
            sql: case when custom_contact_reason like '%order_info/issue%' then 'Order Info/Issue' when custom_contact_reason like '%general_information%' then 'General Information' when custom_contact_reason like '%others%' then 'Others' when custom_contact_reason like '%technical_support%' then 'Technical Support' END          
            
  - name: zendesk_call_metric
    meta:
      joins:
        - join: call_leg_overwrite
          sql_on: ${zendesk_call_metric.id} = ${call_leg_overwrite.call_id}
        - join: user_overwrite
          sql_on: ${zendesk_call_metric.agent_id} = ${user_overwrite.id}
    columns:
      - name: id
        data_type: <integer>
        description: "Primary key"
        meta:
          dimension:
            format: id
          metrics:
            ticket_count:
              label: 'Number of tickets coming from phone'
              type: count_distinct
              description: "Number of tickets coming from phone"
              hidden: false
              round: 0      
      - name: agent_id
        data_type: <integer>
        description: "Agent ID"
        meta:
          dimension:
            format: id
      - name: call_charge
        data_type: <string>
        description: "Call charge"
      - name: call_group_id
        data_type: <integer>
        description: "Call group ID"
        meta:
          dimension:
            format: id
      - name: call_recording_consent
        data_type: <string>
        description: "Call recording consent"
      - name: call_recording_consent_action
        data_type: <string>
        description: "Call recording consent action"
      - name: call_recording_consent_keypress
        data_type: <string>
        description: "Call recording consent keypress"
      - name: callback
        data_type: <string>
        description: "Callback"
      - name: callback_source
        data_type: <string>
        description: "Callback source"
      - name: completion_status
        data_type: <string>
        description: "Completion status"
        meta:
          metrics:
            inbound_completed_calls:
              label: 'Inbound completed calls'
              type: sum
              description: "Number of calls with status completed and direction inbound"
              hidden: false
              sql: if(completion_status='completed' and direction='Inbound', 1, 0)
              round: 0      
            inbound_abandoned_in_queue_calls:
              label: 'Inbound abandoned in queue calls'
              type: sum
              description: "Number of calls with status abandoned in queue and direction inbound"
              hidden: false
              sql: if(completion_status='completed' and direction='Inbound', 1, 0)
              round: 0      
            inbound_short_abandoned_in_queue_calls:
              label: 'Inbound short abandoned in queue calls'
              type: sum
              description: "Number of calls with status abandoned in queue, time_to_answer < 20 and direction inbound"
              hidden: false
              sql: if(completion_status='abandoned_in_queue' and direction='Inbound' and time_to_answer<20, 1, 0)
              round: 0      
      - name: consultation_time
        data_type: <integer>
        description: "Consultation time"
      - name: created_at
        data_type: <timestamp>
        description: "Created at"
      - name: customer_requested_voicemail
        data_type: <string>
        description: "Customer requested voicemail"
      - name: default_group
        data_type: <string>
        description: "Default group"
      - name: direction
        data_type: <string>
        description: "Direction"
        meta:
          metrics:
            outbound_calls:
              label: 'Oubtbound calls'
              type: sum
              description: "Number of calls with direction outbound"
              hidden: false
              sql: if(direction='Outbound', 1, 0)
              round: 0      
      - name: duration
        data_type: <integer>
        description: "Duration"
      - name: exceeded_queue_wait_time
        data_type: <string>
        description: "Exceeded queue wait time"
      - name: hold_time
        data_type: <integer>
        description: "Hold time"
      - name: ivr_action
        data_type: <string>
        description: "IVR action"
      - name: ivr_destination_group_name
        data_type: <string>
        description: "IVR destination group name"
      - name: ivr_hops
        data_type: <integer>
        description: "IVR hops"
      - name: ivr_routed_to
        data_type: <string>
        description: "IVR routed to"
      - name: ivr_time_spent
        data_type: <integer>
        description: "IVR time spent"
      - name: minutes_billed
        data_type: <integer>
        description: "Minutes billed"
      - name: not_recording_time
        data_type: <integer>
        description: "Not recording time"
      - name: outside_business_hours
        data_type: <string>
        description: "Outside business hours"
      - name: overflowed
        data_type: <string>
        description: "Overflowed"
      - name: overflowed_to
        data_type: <string>
        description: "Overflowed to"
      - name: phone_number
        data_type: <string>
        description: "Phone number"
      - name: phone_number_id
        data_type: <integer>
        description: "Phone number id"
      - name: quality_issues
        data_type: <string>
        description: "Quality issues"
      - name: recording_control_interactions
        data_type: <integer>
        description: "Recording control interactions"
      - name: recording_time
        data_type: <integer>
        description: "Recording time"
      - name: talk_time
        data_type: <integer>
        description: "Talk time"
      - name: ticket_id
        data_type: <integer>
        description: "Ticket id"
        meta:
          dimension:
            format: id
      - name: time_to_answer
        data_type: <integer>
        description: "Time to answer"
        meta:
          metrics:
            answered_less_than_20s:
              label: 'Total number of tickets from zendesk answered in less than 20s'
              type: sum
              description: "Total number of tickets from zendesk answered in less than 20s"
              hidden: false
              sql: IF(time_to_answer<20, 1, 0)
              round: 0      
      - name: updated_at
        data_type: <timestamp>
        description: "Update date"
      - name: voicemail
        data_type: <string>
        description: "Voicemail"
      - name: wait_time
        data_type: <integer>
        description: "Wait time"
      - name: wrap_up_time
        data_type: <integer>
        description: "Wrap up time"
      - name: created_at_day_of_week
        description: "Day of the week"
        meta:
          dimension:
            type: string
            sql: FORMAT_DATE('%a', created_at)          
      - name: created_at_hour_of_the_day
        description: "Hour of the day"
        meta:
          dimension:
            type: number
            sql: extract(hour from created_at)          
      - name: created_at_mon_of_the_year
        description: "Month of the year in letters"
        meta:
          dimension:
            type: string
            sql: FORMAT_DATETIME("%B", DATETIME(created_at))          
      - name: wait_time_bucket
        description: "Wait time bucket in s"
        meta:
          dimension:
            type: string
            sql: case when wait_time < 10 then '0-10 sec' when wait_time < 20 then '10-20 sec' when wait_time < 30 then '20-30 sec' when wait_time < 60 then '30-60 sec' when wait_time < 300 then '60-300 sec' else '>300 sec' end
      - name: call_duration_bucket
        description: "Call duration bucket in min"
        meta:
          dimension:
            type: string
            sql: case when duration < 300 then '0-5 min' when duration < 600 then '5-10 min' when duration < 900 then '10-15 min' when duration < 1200 then '15-20 min' else '>20 min' end
      - name: aht
        description: "AHT duration"
        meta:
          dimension:
            type: number
            sql: ifnull(wait_time, 0) + ifnull(talk_time, 0) + ifnull(time_to_answer, 0) + ifnull(wrap_up_time, 0)

  - name: daily_zendesk_call
    columns:
      - name: created_at
        description: "created_at"
        meta:
          dimension:
            type: date
            time_intervals: ['DAY', 'WEEK', 'MONTH', 'QUARTER']
            sql: 'timestamp(daily_zendesk_call.created_at, "Europe/London")'             
      - name: number_of_calls
        description: "Number of calls"
        meta:
          metrics:
            total_zendesk_calls:
              label: 'Total number of calls from zendesk'
              type: sum
              description: "Number of calls from Zendesk"
              hidden: false
              round: 0      
      - name: inbound_calls
        description: "Number of inbound calls"
        meta:
          metrics:
            total_zendesk_inbound_calls:
              label: 'Total number of inbound calls from zendesk'
              type: sum
              description: "Number of inbound calls from Zendesk"
              hidden: false
              round: 0      
      - name: outbound_calls
        description: "Number of outbound calls"
        meta:
          metrics:
            total_zendesk_inbound_calls:
              label: 'Total number of outbound calls from zendesk'
              type: sum
              description: "Number of outbound calls from Zendesk"
              hidden: false
              round: 0      
      - name: completed_calls
        description: "Number of completed calls"
        meta:
          metrics:
            total_zendesk_completed_calls:
              label: 'Total number of completed calls from zendesk'
              type: sum
              description: "Number of completed calls from Zendesk"
              hidden: false
              round: 0      
      - name: abandoned_calls
        description: "Number of abandoned calls"
        meta:
          metrics:
            total_zendesk_abandoned_calls:
              label: 'Total number of abandoned calls from zendesk'
              type: sum
              description: "Number of abandoned calls from Zendesk"
              hidden: false
              round: 0      
      - name: call_duration
        data_type: <string>
        description: "Sum of all calls duration in HH:mm:SS format"
      - name: inbound_duration
        data_type: <string>
        description: "Sum of inbound calls duration in HH:mm:SS format"
      - name: outbound_duration
        data_type: <string>
        description: "Sum of outbound calls duration in HH:mm:SS format"
      - name: completed_duration
        data_type: <string>
        description: "Sum of completed calls duration in HH:mm:SS format"
      - name: abandoned_duration
        data_type: <string>
        description: "Sum of abandoned calls duration in HH:mm:SS format"
      - name: avg_call_duration
        data_type: <string>
        description: "Avg of all calls duration in HH:mm:SS format"
      - name: avg_inbound_duration
        data_type: <string>
        description: "Avg of inbound calls duration in HH:mm:SS format"
      - name: avg_outbound_duration
        data_type: <string>
        description: "Avg of outbound calls duration in HH:mm:SS format"
      - name: avg_completed_duration
        data_type: <string>
        description: "Avg of completed calls duration in HH:mm:SS format"
      - name: avg_abandoned_duration
        data_type: <string>
        description: "Avg of abandoned calls duration in HH:mm:SS format"
      - name: max_call_duration
        data_type: <string>
        description: "Max of all calls duration in HH:mm:SS format"
      - name: max_inbound_duration
        data_type: <string>
        description: "Max of inbound calls duration in HH:mm:SS format"
      - name: max_outbound_duration
        data_type: <string>
        description: "Max of outbound calls duration in HH:mm:SS format"
      - name: max_completed_duration
        data_type: <string>
        description: "Max of completed calls duration in HH:mm:SS format"
      - name: max_abandoned_duration
        data_type: <string>
        description: "Max of abandoned calls duration in HH:mm:SS format"
      - name: avg_call_tta
        data_type: <string>
        description: "Avg of all calls time to answer in HH:mm:SS format"
      - name: avg_inbound_tta
        data_type: <string>
        description: "Avg of inbound calls time to answer in HH:mm:SS format"
      - name: avg_outbound_ttan
        data_type: <string>
        description: "Avg of outbound calls time to answer in HH:mm:SS format"
      - name: avg_completed_tta
        data_type: <string>
        description: "Avg of completed calls time to answer in HH:mm:SS format"
      - name: avg_abandoned_tta
        data_type: <string>
        description: "Avg of abandoned calls time to answer in HH:mm:SS format"
      - name: avg_call_wait_time
        data_type: <string>
        description: "Avg of all calls duratwait timeion in HH:mm:SS format"
      - name: avg_inbound_wait_time
        data_type: <string>
        description: "Avg of inbound calls wait time in HH:mm:SS format"
      - name: avg_outbound_wait_time
        data_type: <string>
        description: "Avg of outbound calls wait time in HH:mm:SS format"
      - name: avg_completed_wait_time
        data_type: <string>
        description: "Avg of completed calls wait time in HH:mm:SS format"
      - name: avg_abandoned_wait_time
        data_type: <string>
        description: "Avg of abandoned calls wait time in HH:mm:SS format"

  - name: zendesk__ticket_metrics_overwrite
    description: Each record represents a Zendesk ticket, enriched with metrics about reply times, resolution times and work times.  Calendar and business hours are supported
    columns:
      - name: first_reply_time_calendar_minutes
        description: "The number of calendar minutes between when the ticket was created and when the first public agent response occurred"
      - name: first_reply_time_business_minutes
        description: "The number of business minutes between when the ticket was created and when the first public agent response occurred"
      - name: total_reply_time_calendar_minutes
        description: "The combined calendar time between all end-user comments and the next public agent response"
      - name: first_solved_at
        description: "The time the ticket was first in 'solved' status"
      - name: last_solved_at
        description: "The time the ticket was last in 'solved' status"
      - name: first_resolution_calendar_minutes
        description: "The number of calendar minutes between the ticket created time and the time the ticket was first set to solved status"
      - name: final_resolution_calendar_minutes
        description: "The number of calendar minutes between the ticket created time and the time the ticket was last set to solved status"
      - name: is_one_touch_resolution
        description: "A boolean field indicating that the ticket has one public agent response and is in solved status"
        meta: 
          metrics:
            one_touch_tickets:
              label: 'One touch tickets'
              type: sum
              description: "Number of One-touch tickets"
              hidden: false
              sql: "if(is_one_touch_resolution, 1, 0)"
      - name: first_resolution_business_minutes
        description: "The number of business minutes between the ticket created time and the time the ticket was first set to solved status"
      - name: full_resolution_business_minutes
        description: "The number of business minutes between the ticket created time and the time the ticket was last set to solved status"
      - name: agent_wait_time_in_business_minutes
        description: "The combined number of business minutes the ticket was in 'pending' status"
      - name: requester_wait_time_in_business_minutes
        description: "The combined number of business minutes the ticket was in 'new', 'open', or 'hold' status"
      - name: agent_work_time_in_business_minutes
        description: "The combined number of business minutes the ticket was in 'new' or 'open' status"
      - name: on_hold_time_in_business_minutes
        description: "The combined number of business minutes the ticket was on 'hold' status"
      - name: agent_wait_time_in_calendar_minutes
        description: "The combined number of calendar minutes the ticket was in 'pending' status"
      - name: requester_wait_time_in_calendar_minutes
        description: "The combined number of calendar minutes the ticket was in 'new', 'open', or 'hold' status"
      - name: agent_work_time_in_calendar_minutes
        description: "The combined number of calendar minutes the ticket was in 'new' or 'open' status"
      - name: on_hold_time_in_calendar_minutes
        description: "The combined number of calendar minutes the ticket was on 'hold' status"
      - name: ticket_id
        description: "Automatically assigned when the ticket is created"
        tests:
            - unique
            - not_null 
        meta: 
          metrics:
            total_customers_with_subsequent_order:
              label: 'Customers with subsequent order'
              type: count_distinct
              description: "Number of customers who have returned to make another order"
              hidden: false
              sql: "if((${status} in 'solved', 'closed') and ${total_agent_replies}<=2, ${ticket_id}, null)"
      - name: url
        description: "The API url of this ticket"
      - name: assignee_id
        description: "The agent currently assigned to the ticket"
      - name: assignee_role
        description: "The role of the agent currently assigned to the ticket"
      - name: assignee_email
        description: "The email of the agent currently assigned to the ticket"
      - name: assignee_name
        description: "The name of the agent currently assigned to the ticket"
      - name: brand_id
        description: "Enterprise only. The id of the brand this ticket is associated with"
      - name: created_at
        description: "When this record was created"
      - name: type
        description: "The type of this ticket, possible values are problem, incident, question or task"
      - name: subject
        description: "The value of the subject field for this ticket"
      - name: description
        description: "Read-only first comment on the ticket"
      - name: priority
        description: "The urgency with which the ticket should be addressed, possible values are urgent, high, normal and low"
      - name: status
        description: "The state of the ticket, possible values are new, open, pending, hold, solved and closed"
        meta: 
          metrics:
            solved_ticket:
              label: 'Solved tickets'
              type: sum
              description: "Number of tickets solved"
              hidden: false
              sql: "IF(status in ('closed', 'solved'), 1, 0)"
      - name: recipient
        description: "The original recipient e-mail address of the ticket"
      - name: requester_id
        description: "The user who requested this ticket"
      - name: requester_role
        description: "The role of the user who requested this ticket"
      - name: requester_email
        description: "The email of the user who requested this ticket"
      - name: requester_name
        description: "The name of the user who requested this ticket"
      - name: submitter_id
        description: "The user who submitted the ticket. The submitter always becomes the author of the first comment on the ticket"
      - name: submitter_role
        description: "The role of the user who submitted the ticket."
      - name: submitter_email
        description: "The email of the user who submitted the ticket."
      - name: submitter_name
        description: "The name of the user who submitted the ticket."
      - name: organization_id
        description: "The organization of the requester"
      - name: organization_name
        description: "The name of the organization of the requester"
      - name: external_id
        description: "The external id of the ticket"
      - name: group_id
        description: "The group this ticket is assigned to"
      - name: group_name
        description: "The name of the group this ticket is assigned to"
      - name: due_at
        description: "If this is a ticket of type 'task' it has a due date. Due date format uses ISO 8601 format."
      - name: ticket_form_id
        description: "Enterprise only. The id of the ticket form to render for the ticket"
      - name: is_public
        description: "Is true if any comments are public, false otherwise"
      - name: updated_at
        description: "When this record last got updated"
      - name: created_channel
        description: "The channel the ticket was created from"
      - name: source_from_id
        description: "The channel the ticket was created from" 
      - name: source_from_title
        description: "The channel the ticket was created from"
      - name: source_rel
        description: "The rel the ticket was created from" 
      - name: source_to_address
        description: "The address of the source the ticket was created from"
      - name: source_to_name
        description: "The name of the source the ticket was created from"  
      - name: ticket_tags
        description: "A list of all tags assigned to this ticket"
      - name: problem_id
        description: "The reference to the problem if the ticket is listed as a problem"
      - name: is_incident
        description: "Boolean indicating whether the ticket is listed as an incident"
      - name: ticket_brand_name
        description: "The brand name of with the ticket"
      - name: ticket_form_name
        description: "The form name of the ticket"
      - name: ticket_satisfaction_rating
        description: "The ticket satisfaction rating"
      - name: ticket_satisfaction_comment
        description: "The ticket satisfaction comment"
      - name: ticket_satisfaction_reason
        description: "The ticket satisfaction reason"
      - name: ticket_organization_domain_names
        description: "The organization associated with the ticket domain names"
      - name: requester_organization_domain_names
        description: "The ticket requesters organization domain names" 
      - name: requester_external_id
        description: "The ticket requester external id"
      - name: requester_created_at
        description: "The date the ticket requester was created"
      - name: requester_updated_at
        description: "The date the ticket requester was last updated"
      - name: is_requester_active
        description: "Boolean indicating whether the requester is currently active"
      - name: requester_locale
        description: "The locale of the ticket requester"
      - name: requester_time_zone
        description: "The timezone of the ticket requester"
      - name: requester_ticket_update_count
        description: "The number of times the requester has updated the ticket"
      - name: requester_ticket_last_update_at
        description: "The last date the requester updated the ticket"
      - name: requester_last_login_at
        description: "The last login of the ticket requester"
      - name: requester_organization_id
        description: "The organization id of the ticket requester"
      - name: requester_organization_name
        description: "The organization name of the ticket requester"
      - name: requester_organization_tags
        description: "The organization tags of the ticket requester"
      - name: requester_organization_external_id
        description: "The organization external id of the ticket requester"
      - name: requester_organization_created_at
        description: "The date the ticket requesters organization was created"
      - name: requester_organization_updated_at
        description: "The date the ticket requesters organization was last updated"
      - name: submitter_external_id
        description: "The ticket submitter external id"
      - name: is_agent_submitted
        description: "Boolean indicating if the submitter has an agent role"
      - name: is_submitter_active
        description: "Boolean indicating if the ticket submitter is active"
      - name: submitter_locale
        description: "The locale of the ticket submitter"
      - name: submitter_time_zone
        description: "The time zone of the ticket submitter"
      - name: assignee_external_id
        description: "The external id of the ticket assignee"
      - name: is_assignee_active
        description: "Boolean indicating if the ticket assignee is active"
      - name: assignee_locale
        description: "The locale of the ticket assignee"
      - name: assignee_time_zone
        description: "The time zone of the ticket assignee"
      - name: assignee_ticket_update_count
        description: "The number of times the ticket assignee has updated the ticket"
      - name: assignee_ticket_last_update_at
        description: "The last date the ticket assignee updated the ticket"
      - name: assignee_last_login_at
        description: "The date the ticket assignee last logged in"
      - name: requester_tag
        description: "The tags associated with the ticket requester."
      - name: submitter_tag
        description: "The tags associated with the ticket submitter."
      - name: assignee_tag
        description: "The tags associated with the ticket assignee."
      - name: ticket_total_satisfaction_scores
        description: "The total number of satisfaction scores the ticket received."
      - name: ticket_first_satisfaction_score
        description: "The first satisfaction score the ticket received."
      - name: ticket_satisfaction_score
        description: "The latest satisfaction score the ticket received."
        meta: 
          metrics:
            satisified_customer:
              label: 'Tickets with satisfied customers'
              type: sum
              description: "Number of satisfaction score = Good"
              hidden: false
              sql: "if(ticket_satisfaction_score='Good', 1, 0)"
            rated_ticket:
              label: 'Tickets rated'
              type: sum
              description: "Number of satisfaction score = Good or bad"
              hidden: false
              sql: "if(ticket_satisfaction_score in ('Good', 'Bad'), 1, 0)"
            surveyed_ticket:
              label: 'Tickets surveyed'
              type: sum
              description: "Number of satisfaction score = Good or bad or offered"
              hidden: false
              sql: "if(ticket_satisfaction_score in ('Offered', 'Good', 'Bad'), 1, 0)"
            rated_ticket_wt_comment:
              label: 'Tickets rated without any comment'
              type: sum
              description: "Number of satisfaction score = Good or Bad and total_comments=0"
              hidden: false
              sql: "if(ticket_satisfaction_score in ('Good', 'Bad') and total_comments=0, 1, 0)"
      - name: is_good_to_bad_satisfaction_score
        description: "Boolean indicating if the ticket had a satisfaction score went from good to bad."
      - name: is_bad_to_good_satisfaction_score
        description: "Boolean indicating if the ticket had a satisfaction score went from bad to good."
      - name: count_agent_comments
        description: "Count of agent comments within the ticket"
      - name: count_public_agent_comments
        description: "Count of public agent comments within the ticket"
      - name: count_end_user_comments
        description: "Count of end user comments within the ticket"
      - name: count_internal_comments
        description: "Count of internal comments within the ticket"
      - name: count_public_comments
        description: "Count of public comments within the ticket"
      - name: total_comments
        description: "Total count of all comments within the ticket"
      - name: count_ticket_handoffs
        description: "Count of distinct internal users who have touched/commented on the ticket."
      - name: unique_assignee_count
        description: "The count of unique assignees that were assigned to the ticket"
      - name: assignee_stations_count
        description: "The total number of assignees that were assigned to the ticket"
      - name: group_stations_count
        description: "The total count of group stations within the ticket"
      - name: first_assignee_id
        description: "Assignee id of the first agent assigned to the ticket"
      - name: last_assignee_id
        description: "Assignee id of the last agent assigned to the ticket"
      - name: first_agent_assignment_date
        description: "The date the first agent was assigned to the ticket"
      - name: last_agent_assignment_date
        description: "The date the last agent was assigned to the ticket"
      - name: first_assignment_to_resolution_calendar_minutes
        description: "The time in calendar minutes between the first assignment and resolution of the ticket"
      - name: last_assignment_to_resolution_calendar_minutes
        description: "The time in calendar minutes between the last assignment and resolution of the ticket"
      - name: count_resolutions
        description: "The count of ticket resolutions"
      - name: count_reopens
        description: "The count of ticket reopen events"
      - name: new_status_duration_in_calendar_minutes
        description: "The duration in calendar minutes the ticket was in the 'new' status"
      - name: open_status_duration_in_calendar_minutes
        description: "The duration in calendar minutes the ticket was in the 'open' status"
      - name: total_agent_replies
        description: "The total number of agent replies within the ticket"
        meta: 
          metrics:
            zero_reply_ticket:
              label: 'Zero reply tickets'
              type: sum
              description: "Number of tickets solved without any reply"
              hidden: false
              sql: "if(total_agent_replies=0, 1, 0)"
      - name: requester_last_login_age_minutes
        description: "The time in minutes since the ticket requester was last logged in"
      - name: assignee_last_login_age_minutes
        description: "The time in minutes since the ticket assignee was last logged in"
      - name: unsolved_ticket_age_minutes
        description: "The time in minutes the ticket has been in an unsolved state"
      - name: unsolved_ticket_age_since_update_minutes
        description: "The time in minutes the ticket has been unsolved since the last update"
      - name: is_two_touch_resolution
        description: "Boolean indicating if the ticket was resolved in two public comments"
      - name: is_multi_touch_resolution
        description: "Boolean indicating if the ticket was resolved in two or more public comments"
      - name: ticket_last_comment_date
        description: "The time the last comment was applied to the ticket"
      - name: ticket_unassigned_duration_calendar_minutes
        description: "The time in minutes the ticket was in an unassigned state"
      - name: last_status_assignment_date
        description: "The time the status was last changed on the ticket"
      - name: created_at_day_of_week
        description: "Day of the week when the ticket was created"
        meta:
          dimension:
            type: string
            sql: FORMAT_DATE('%a', created_at)
      - name: created_at_hour_of_the_day
        description: "Hour of the day the ticket was created"
        meta:
          dimension:
            type: number
            sql: extract(hour from created_at) 
      - name: first_reply_time_hours_business_bucket
        description: "Bucket depending on business time spent on first reply in hours"
        meta:
          dimension:
            type: string
            sql: case when first_reply_time_business_minutes < 60 then '0-1 hrs' when first_reply_time_business_minutes <120 then '1-2 hrs' when first_reply_time_business_minutes <240 then '2-4 hrs' when first_reply_time_business_minutes <480 then '4-8 hrs' else '>8 hrs' END 
      - name: first_reply_time_min_business_bucket
        description: "Bucket depending on business time spent on first reply in minutes"
        meta:
          dimension:
            type: string
            sql: case when first_reply_time_business_minutes <=1  then '0-1 mins' when first_reply_time_business_minutes <=3 then '1-3 mins' when first_reply_time_business_minutes <=10 then '3-10 mins' else '>10 mins' END 
      - name: requester_wait_time_min_business_bucket
        description: "Bucket depending on business time spent on waiting in minutes"
        meta:
          dimension:
            type: string
            sql: case when requester_wait_time_in_business_minutes <=1  then '0-1 mins' when requester_wait_time_in_business_minutes <=3 then '1-3 mins' when requester_wait_time_in_business_minutes <=10 then '3-10 mins' when requester_wait_time_in_business_minutes <=30 then '10-30 mins' else '>30 mins' END
      - name: full_resolution_business_bucket
        description: "Bucket depending on business time spent on full resolution in hours"
        meta:
          dimension:
            type: string
            sql: case when full_resolution_business_minutes < 120 then '0-2 hrs' when full_resolution_business_minutes < 240 then '2-4 hrs' when full_resolution_business_minutes <480 then '4-8 hrs' when full_resolution_business_minutes <960 then '8-16 hrs' else '>16 hrs' end
      - name: total_agent_replies_bucket
        description: "Bucket depending on number of agent replies"
        meta:
          dimension:
            type: string
            sql: case when total_agent_replies = 1 then '1' when total_agent_replies = 2 then '2' when total_agent_replies < 6 then '3-5' else '>5' END

  - name: zendesk__sla_policies_overwrite
    description: Each record represents an SLA policy event and additional sla breach and achievement metrics. Calendar and business hour SLA breaches are supported.
    columns:
      - name: sla_event_id
        description: "A surrogate key generated from the combination of ticket_id, metric, and sla_applied_at fields"
        tests:
          - unique
      - name: ticket_id
        description: "A ticket's unique identifier, it is automatically assigned when the ticket is created"
      - name: sla_policy_name
        description: "The name of the SLA policy associated with the SLA metric"
      - name: metric
        description: "The SLA metric, either agent_work_time, requester_wait_time, first_reply_time or next_reply_time"
      - name: sla_applied_at
        description: "When the SLA target was triggered. This is the starting time"
      - name: target
        description: "The SLA target, in minutes"
      - name: in_business_hours
        description: "Boolean field indicating if the SLA target is in business hours (true) or calendar hours (false)"
      - name: sla_breach_at
        description: "The time or expected time of the SLA breach event"
      - name: sla_elapsed_time
        description: "The total elapsed time to achieve the SLA metric whether breached or achieved"
      - name: is_active_sla
        description: "Boolean field indicating that the SLA event is currently active and not breached (true) or past (false)"
      - name: is_sla_breach
        description: "Boolean field indicating if the SLA has been breached (true) or was achieved (false)"
      - name: breached_time
        description: "sla_elapsed_time - target"
        meta:
          dimension:
            type: number
            sql: sla_elapsed_time-target
  - name: call_leg_overwrite
    columns:
      - name: id
        data_type: <integer>
        description: "id"
      - name: agent_id
        data_type: <integer>
        description: "agent_id"
      - name: available_via
        data_type: <string>
        description: "available_via"
      - name: call_charge
        data_type: <string>
        description: "call_charge"
      - name: call_id
        data_type: <integer>
        description: "call_id"
      - name: completion_status
        data_type: <string>
        description: "completion_status"
      - name: conference_from
        data_type: <integer>
        description: "conference_from"
      - name: conference_time
        data_type: <integer>
        description: "conference_time"
      - name: conference_to
        data_type: <integer>
        description: "conference_to"
      - name: consultation_from
        data_type: <integer>
        description: "consultation_from"
      - name: consultation_time
        data_type: <integer>
        description: "consultation_time"
      - name: consultation_to
        data_type: <integer>
        description: "consultation_to"
      - name: created_at
        data_type: <timestamp>
        description: "created_at"
      - name: duration
        data_type: <integer>
        description: "duration"
      - name: forwarded_to
        data_type: <string>
        description: "forwarded_to"
      - name: hold_time
        data_type: <integer>
        description: "hold_time"
      - name: minutes_billed
        data_type: <integer>
        description: "minutes_billed"
      - name: talk_time
        data_type: <integer>
        description: "talk_time"
      - name: transferred_from
        data_type: <integer>
        description: "transferred_from"
      - name: transferred_to
        data_type: <integer>
        description: "transferred_to"
      - name: type
        data_type: <string>
        description: "type"
      - name: updated_at
        data_type: <timestamp>
        description: "updated_at"
  - name: user_overwrite
    columns:
      - name: id
        data_type: <integer>
        description: "primary key"
      - name: active
        data_type: <string>
        description: "active"
      - name: alias
        data_type: <string>
        description: "alias"
      - name: authenticity_token
        data_type: <string>
        description: "authenticity_token"
      - name: chat_only
        data_type: <string>
        description: "chat_only"
      - name: created_at
        data_type: <timestamp>
        description: "created_at"
      - name: custom_agent_s_company
        data_type: <string>
        description: "custom_agent_s_company"
      - name: custom_don_t_send_csat
        data_type: <string>
        description: "custom_don_t_send_csat"
      - name: custom_don_t_send_pending_reminder
        data_type: <string>
        description: "custom_don_t_send_pending_reminder"
      - name: custom_role_id
        data_type: <integer>
        description: "custom_role_id"
      - name: email
        data_type: <string>
        description: "email"
      - name: external_id
        data_type: <string>
        description: "external_id"
      - name: iana_time_zone
        data_type: <string>
        description: "iana_time_zone"
      - name: last_login_at
        data_type: <timestamp>
        description: "last_login_at"
      - name: locale
        data_type: <string>
        description: "locale"
      - name: locale_id
        data_type: <integer>
        description: "locale_id"
      - name: moderator
        data_type: <string>
        description: "moderator"
      - name: name
        data_type: <string>
        description: "name"
      - name: notes
        data_type: <string>
        description: "notes"
      - name: only_private_comments
        data_type: <string>
        description: "only_private_comments"
      - name: organization_id
        data_type: <integer>
        description: "organization_id"
      - name: phone
        data_type: <string>
        description: "phone"
      - name: remote_photo_url
        data_type: <string>
        description: "remote_photo_url"
      - name: report_csv
        data_type: <string>
        description: "report_csv"
      - name: restricted_agent
        data_type: <string>
        description: "restricted_agent"
      - name: role
        data_type: <string>
        description: "role"
      - name: shared
        data_type: <string>
        description: "shared"
      - name: shared_agent
        data_type: <string>
        description: "shared_agent"
      - name: signature
        data_type: <string>
        description: "signature"
      - name: suspended
        data_type: <string>
        description: "suspended"
      - name: ticket_restriction
        data_type: <string>
        description: "ticket_restriction"
      - name: time_zone
        data_type: <string>
        description: "time_zone"
      - name: two_factor_auth_enabled
        data_type: <string>
        description: "two_factor_auth_enabled"
      - name: updated_at
        data_type: <timestamp>
        description: "updated_at"
      - name: url
        data_type: <string>
        description: "url"
      - name: verified
        data_type: <string>
        description: "verified"
