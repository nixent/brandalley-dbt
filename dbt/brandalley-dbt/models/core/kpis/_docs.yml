version: 2

models:
  - name: daily_sales
    meta:
      group_label: 'KPIs'
    columns:
      - name: date_day
        meta:
          dimension:
            type: date
            label: 'Date'
      - name: ba_site
        meta:
          dimension:
            label: 'BA Site'
      - name: sales_launched
        meta:
          dimension:
            hidden: true
          metrics:
            all_sales_launched:
              type: string
              label: 'Sales Launched'
              group_label: 'Sales Launched'
              sql: 'string_agg(daily_sales.sales_launched)'
      - name: sales_launched_ly
        meta:
          dimension:
            hidden: true
          metrics:
            all_sales_launched_ly:
              type: string
              label: 'Sales Launched LY'
              group_label: 'Sales Launched'
              sql: 'string_agg(daily_sales.sales_launched_ly)'

      ######### ORDERS #########
      - name: total_order_count
        meta:
          dimension:
            hidden: true
          metrics:
            total_orders_count:
              type: sum
              label: 'Total Orders'
              group_label: 'Orders'
      - name: last_year_total_order_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_total_order_count:
              type: sum
              label: 'LY Orders (MTD or YTD)'
              group_label: 'Orders'
            last_year_mtd_ytd_total_order_comparison:
              type: number
              sql: '${total_orders_count} - ${last_year_mtd_ytd_total_order_count}'
              label: 'LY Orders Comparison (MTD or YTD)'
              group_label: 'Orders'
            last_year_smtd_ytd_total_order_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_orders_count} - ${last_year_mtd_ytd_total_order_count},${last_year_mtd_ytd_total_order_count})'
              label: 'LY Orders Comparison % (MTD or YTD)'
              group_label: 'Orders'
              round: 1
      - name: last_year_same_day_total_order_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_total_order_count:
              type: sum
              label: 'LY Orders (Day or WTD)'
              group_label: 'Orders'
            last_year_same_day_wtd_total_order_comparison:
              type: number
              sql: '${total_orders_count} - ${last_year_same_day_wtd_total_order_count}'
              label: 'LY Orders Comparison (Day or WTD)'
              group_label: 'Orders'
            last_year_same_day_wtd_total_order_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_orders_count} - ${last_year_same_day_wtd_total_order_count},${last_year_same_day_wtd_total_order_count})'
              label: 'LY Orders Comparison % (Day or WTD)'
              group_label: 'Orders'
              round: 1
      - name: all_orders_target
        meta:
          dimension:
            hidden: true
          metrics:
            total_all_orders_target:
              type: sum
              label: 'Orders Target'
              group_label: 'Orders'
            total_order_wtd_target_comparison:
              type: number
              sql: '${total_orders_count} - ${total_all_orders_target}'
              label: 'Orders Target Comparison'
              group_label: 'Orders'
            total_order_wtd_target_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_orders_count} - ${total_all_orders_target},${total_all_orders_target})'
              label: 'Orders Target Comparison %'
              group_label: 'Orders'
              round: 1

      ##### CUSTOMERS #######
      - name: total_new_customer_count
        meta:
          dimension:
            hidden: true
          metrics:
            total_new_customers_count:
              type: sum
              label: 'New Customers'
              group_label: 'Customers'
            avg_new_customers_count:
              type: average
              label: 'Avg Customers'
              group_label: 'Customers'
              round: 0
      - name: last_year_total_new_customer_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_total_new_customer_count:
              type: sum
              label: 'LY New Customers (MTD or YTD)'
              group_label: 'Customers'
            last_year_mtd_ytd_new_customer_comparison:
              type: number
              sql: '${total_new_customers_count} - ${last_year_mtd_ytd_total_new_customer_count}'
              label: 'LY New Customers Comparison (MTD or YTD)'
              group_label: 'Customers'
            last_year_mtd_ytd_new_customer_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_new_customers_count} - ${last_year_mtd_ytd_total_new_customer_count},${last_year_mtd_ytd_total_new_customer_count})'
              label: 'LY New Customers Comparison % (MTD or YTD)'
              group_label: 'Customers'
              round: 1
      - name: last_year_same_day_total_new_customer_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_total_new_customer_count:
              type: sum
              label: 'LY New Customers (Day or WTD)'
              group_label: 'Customers'
            last_year_same_day_wtd_new_customer_comparison:
              type: number
              sql: '${total_new_customers_count} - ${last_year_same_day_wtd_total_new_customer_count}'
              label: 'LY New Customers Comparison (Day or WTD)'
              group_label: 'Customers'
            last_year_same_day_wtd_new_customer_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_new_customers_count} - ${last_year_same_day_wtd_total_new_customer_count},${last_year_same_day_wtd_total_new_customer_count})'
              label: 'LY New Customers Comparison % (Day or WTD)'
              group_label: 'Customers'
              round: 1
      - name: new_customers_target
        meta:
          dimension:
            hidden: true
          metrics:
            total_new_customers_target:
              type: sum
              label: 'Customers Target'
              group_label: 'Customers'
            total_new_customers_target_comparison:
              type: number
              sql: '${total_new_customers_count} - ${total_new_customers_target}'
              label: 'New Customers Target Comparison'
              group_label: 'Customers'
            total_new_customers_target_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_new_customers_count} - ${total_new_customers_target},${total_new_customers_target})'
              label: 'New Customers Target Comparison %'
              group_label: 'Customers'
              round: 1
            
      ##### MEMBERS ######
      - name: total_new_members
        meta:
          dimension:
            hidden: true
          metrics:
            total_new_members_count:
              type: sum
              label: 'New Members'
              group_label: 'Members'
            avg_new_members_count:
              type: average
              label: 'Avg Members'
              group_label: 'Members'
              round: 0
      - name: last_year_total_new_member_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_total_new_member_count:
              type: sum
              label: 'LY New Members (MTD or YTD)'
              group_label: 'Members'
            last_year_mtd_ytd_total_new_member_count_comparison:
              type: number
              sql: '${total_new_members_count} - ${last_year_mtd_ytd_total_new_member_count}'
              label: 'LY New Members Comparison (MTD or YTD)'
              group_label: 'Members'
            last_year_mtd_ytd_total_new_member_count_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_new_members_count} - ${last_year_mtd_ytd_total_new_member_count},${last_year_mtd_ytd_total_new_member_count})'
              label: 'LY New Members Comparison % (MTD or YTD)'
              group_label: 'Members'
              round: 1
      - name: last_year_same_day_total_new_member_count
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_total_new_member_count:
              type: sum
              label: 'LY New Members (Day or WTD)'
              group_label: 'Members'
            last_year_same_day_wtd_new_member_comparison:
              type: number
              sql: '${total_new_members_count} - ${last_year_same_day_wtd_total_new_member_count}'
              label: 'LY New Members Comparison (Day or WTD)'
              group_label: 'Members'
            last_year_same_day_wtd_new_member_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_new_members_count} - ${last_year_same_day_wtd_total_new_member_count},${last_year_same_day_wtd_total_new_member_count})'
              label: 'LY New Members Comparison % (Day or WTD)'
              group_label: 'Members'
              round: 1
      - name: new_members_target
        meta:
          dimension:
            hidden: true
          metrics:
            total_new_members_target:
              type: sum
              label: 'Members Target'
              group_label: 'Members'
            total_new_members_target_comparison:
              type: number
              sql: '${total_new_members_count} - ${total_new_members_target}'
              label: 'New Members Target Comparison'
              group_label: 'Members'
            total_new_members_target_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_new_members_count} - ${total_new_members_target},${total_new_members_target})'
              label: 'New Members Target Comparison %'
              group_label: 'Members'
              round: 1

      ######## AOV GMV #######
      - name: aov_gmv
        meta:
          dimension:
            hidden: true
          metrics:
            total_aov_gmv:
              type: number
              label: 'AOV GMV'
              group_label: 'AOV'
              sql: 'safe_divide(${total_gmv},${total_orders_count})'
              round: 1
      - name: last_year_aov_gmv
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_aov_gmv:
              type: number
              label: 'LY AOV GMV (MTD or YTD)'
              group_label: 'AOV'
              sql: 'safe_divide(${last_year_mtd_ytd_gmv},${last_year_mtd_ytd_total_order_count})'
              round: 1
            last_year_mtd_ytd_aov_gmv_comparison:
              type: number
              sql: '${total_aov_gmv} - ${last_year_mtd_ytd_aov_gmv}'
              label: 'LY AOV Comparison (MTD or YTD)'
              group_label: 'AOV'
            last_year_mtd_ytd_aov_gmv_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_aov_gmv} - ${last_year_mtd_ytd_aov_gmv},${last_year_mtd_ytd_aov_gmv})'
              label: 'LY AOV Comparison % (MTD or YTD)'
              group_label: 'AOV'
              round: 1
      - name: last_year_same_day_aov_gmv
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_aov_gmv:
              type: number
              label: 'LY AOV GMV (Day or WTD)'
              group_label: 'AOV'
              sql: 'safe_divide(${last_year_same_day_wtd_gmv},${last_year_same_day_wtd_total_order_count})'
              round: 1
            last_year_same_day_wtd_aov_gmv_comparison:
              type: number
              sql: '${total_aov_gmv} - ${last_year_same_day_wtd_aov_gmv}'
              label: 'LY AOV Comparison (Day or WTD)'
              group_label: 'AOV'
            last_year_same_day_wtd_aov_gmv_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_aov_gmv} - ${last_year_same_day_wtd_aov_gmv},${last_year_same_day_wtd_aov_gmv})'
              label: 'LY AOV Comparison % (Day or WTD)'
              group_label: 'AOV'
              round: 1
      - name: aov_target
        meta:
          dimension:
            hidden: true
          metrics:
            total_aov_target:
              type: average
              group_label: 'AOV'
              label: 'AOV GMV Target'
            total_aov_target_comparison:
              type: number
              sql: '${total_aov_gmv} - ${total_aov_target}'
              label: 'AOV GMV Target Comparison'
              group_label: 'AOV'
            total_aov_target_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_aov_gmv} - ${total_aov_target},${total_aov_target})'
              label: 'AOV GMV Target Comparison %'
              group_label: 'AOV'
              round: 1

      #### GMV ######
      - name: gmv
        meta:
          dimension:
            hidden: true
          metrics:
            total_gmv:
              type: sum
              label: 'GMV'
              group_label: 'GMV'
      - name: last_year_gmv
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_gmv:
              type: sum
              label: 'LY GMV (MTD or YTD)'
              group_label: 'GMV'
            last_year_mtd_ytd_total_gmv_comparison:
              type: number
              sql: '${total_gmv} - ${last_year_mtd_ytd_gmv}'
              label: 'LY GMV Comparison (MTD or YTD)'
              group_label: 'GMV'
            last_year_mtd_ytd_total_gmv_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_gmv} - ${last_year_mtd_ytd_gmv},${last_year_mtd_ytd_gmv})'
              label: 'LY GMV Comparison % (MTD or YTD)'
              group_label: 'GMV'
              round: 1
      - name: last_year_same_day_gmv
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_gmv:
              type: sum
              label: 'LY GMV (Day or WTD)'
              group_label: 'GMV'
            last_year_same_day_wtd_gmv_comparison:
              type: number
              sql: '${total_gmv} - ${last_year_same_day_wtd_gmv}'
              label: 'LY GMV Comparison (Day or WTD)'
              group_label: 'GMV'
            last_year_same_day_wtd_gmv_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_gmv} - ${last_year_same_day_wtd_gmv},${last_year_same_day_wtd_gmv})'
              label: 'LY GMV Comparison % (Day or WTD)'
              group_label: 'GMV'
              round: 1
      - name: gmv_target
        meta:
          dimension:
            hidden: true
          metrics:
            total_gmv_target:
              type: sum
              label: 'GMV Target'
              group_label: 'GMV'
            total_gmv_target_comparison:
              type: number
              sql: '${total_gmv} - ${total_gmv_target}'
              label: 'GMV Target Comparison'
              group_label: 'GMV'
            total_gmv_target_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_gmv} - ${total_gmv_target},${total_gmv_target})'
              label: 'GMV Target Comparison %'
              group_label: 'GMV'
              round: 1
      - name: shipping_gmv
        meta:
          dimension:
            hidden: true 
          metrics:
            total_shipping_gmv:
              type: sum
              label: 'Gross Shipping'
              group_label: 'Shipping'
            total_gmv_and_shipping:
              type: number
              label: 'GMV + Gross Shipping'
              sql: '${total_gmv} + ${total_shipping_gmv}'
              group_label: 'Shipping'
            total_shipping_gmv_per_order:
              type: number
              label: 'Gross Shipping / Order'
              sql: 'safe_divide(${total_shipping_gmv},${total_orders_count})'
              round: 2
              group_label: 'Shipping'

      #### SALES AMOUNT ######
      - name: sales_amount
        meta:
          dimension:
            hidden: true
          metrics:
            total_sales_amount:
              type: sum
              label: 'Sales Amount'
              group_label: 'Sales Amount'
              hidden: true
      - name: last_year_sales_amount
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_sales_amount:
              type: sum
              label: 'LY Sales Amount (MTD or YTD)'
              group_label: 'Sales Amount'
              hidden: true
      - name: last_year_same_day_sales_amount
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_sales_amount:
              type: sum
              label: 'LY Sales Amount (Day or WTD)'
              group_label: 'Sales Amount'
              hidden: true
      - name: sales_amount_target
        meta:
          dimension:
            hidden: true
          metrics:
            total_sales_amount_target:
              type: sum
              label: 'Sales Amount Target'
              group_label: 'Sales Amount'
              hidden: true

      ##### MARGIN #######
      - name: margin
        meta:
          dimension:
            hidden: true
          metrics:
            total_margin:
              type: sum
              label: 'Margin'
              group_label: 'Margin'
            total_margin_pct:
              type: number
              label: 'Margin (%)'
              group_label: 'Margin'
              format: 'percent'
              sql: 'safe_divide(${total_margin},${total_sales_amount})'
              round: 1
      - name: last_year_margin
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_margin:
              type: sum
              label: 'LY Margin (MTD or YTD)'
              group_label: 'Margin'
            last_year_mtd_ytd_margin_pct:
              type: number
              label: 'LY Margin (%) (MTD or YTD)'
              group_label: 'Margin'
              format: 'percent'
              sql: 'safe_divide(${last_year_mtd_ytd_margin},${last_year_mtd_ytd_sales_amount})'
              round: 1
            last_year_mtd_ytd_total_margin_comparison:
              type: number
              sql: '${total_margin} - ${last_year_mtd_ytd_margin}'
              label: 'LY Margin Comparison (MTD or YTD)'
              group_label: 'Margin'
            last_year_mtd_ytd_total_margin_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_margin} - ${last_year_mtd_ytd_margin},${last_year_mtd_ytd_margin})'
              label: 'LY Margin Comparison % (MTD or YTD)'
              group_label: 'Margin'
              round: 1
            last_year_mtd_ytd_total_margin_pct_comparison:
              type: number
              format: 'percent'
              sql: '${total_margin_pct} - ${last_year_mtd_ytd_margin_pct}'
              label: 'LY Margin (%) Comparison (MTD or YTD)'
              group_label: 'Margin'
              round: 1
            last_year_mtd_ytd_total_margin_pct_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_margin_pct} - ${last_year_mtd_ytd_margin_pct},${last_year_mtd_ytd_margin_pct})'
              label: 'LY Margin (%) Comparison % (MTD or YTD)'
              group_label: 'Margin'
              round: 1
      - name: last_year_same_day_margin
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_margin:
              type: sum
              label: 'LY Margin (Day or WTD)'
              group_label: 'Margin'
            last_year_same_day_wtd_margin_pct:
              type: number
              label: 'LY Margin (%) (Day or WTD)'
              group_label: 'Margin'
              format: 'percent'
              sql: 'safe_divide(${last_year_same_day_wtd_margin},${last_year_same_day_wtd_sales_amount})'
              round: 1
            last_year_same_day_wtd_margin_comparison:
              type: number
              sql: '${total_margin} - ${last_year_same_day_wtd_margin}'
              label: 'LY Margin Comparison (Day or WTD)'
              group_label: 'Margin'
            last_year_same_day_wtd_margin_pct_comparison:
              type: number
              sql: '${total_margin_pct} - ${last_year_same_day_wtd_margin_pct}'
              label: 'LY Margin (%) Comparison (Day or WTD)'
              format: 'percent'
              group_label: 'Margin'
              round: 1
            last_year_same_day_wtd_margin_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_margin} - ${last_year_same_day_wtd_margin},${last_year_same_day_wtd_margin})'
              label: 'LY Margin Comparison % (Day or WTD)'
              group_label: 'Margin'
              round: 1
            last_year_same_day_wtd_margin_pct_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_margin_pct} - ${last_year_same_day_wtd_margin_pct},${last_year_same_day_wtd_margin_pct})'
              label: 'LY Margin (%) Comparison % (Day or WTD)'
              group_label: 'Margin'
              round: 1
      - name: margin_target
        meta:
          dimension:
            hidden: true
          metrics:
            total_margin_target:
              type: sum
              label: 'Margin Target'
              group_label: 'Margin'
            total_margin_pct_target:
              type: number
              label: 'Margin Target (%)'
              group_label: 'Margin'
              format: 'percent'
              sql: 'safe_divide(${total_margin_target},${total_sales_amount_target})'
              round: 1
            margin_target_comparison:
              type: number
              sql: '${total_margin} - ${total_margin_target}'
              label: 'Margin Target Comparison'
              group_label: 'Margin'
            margin_target_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_margin} - ${total_margin_target},${total_margin_target})'
              label: 'Margin Target Comparison %'
              group_label: 'Margin'
              round: 1
            margin_pct_target_comparison:
              type: number
              sql: '${total_margin_pct} - ${total_margin_pct_target}'
              label: 'Margin (%) Target Comparison'
              format: 'percent'
              group_label: 'Margin'
              round: 1
            margin_pct_target_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_margin_pct} - ${total_margin_pct_target},${total_margin_pct_target})'
              label: 'Margin (%) Target Comparison %'
              group_label: 'Margin'
              round: 1

      #### QTY ORDERED
      - name: qty_ordered
        meta:
          dimension:
            hidden: true
          metrics:
            total_qty_ordered:
              type: sum
              label: 'Units Ordered'
              group_label: 'Units'
      - name: last_year_qty_ordered
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_qty_ordered:
              type: sum
              label: 'LY Units Ordered (MTD or YTD)'
              group_label: 'Units'
            last_year_mtd_ytd_qty_ordered_comparison:
              type: number
              sql: '${total_qty_ordered} - ${last_year_mtd_ytd_qty_ordered}'
              label: 'LY Units Comparison (MTD or YTD)'
              group_label: 'Units'
            last_year_mtd_ytd_qty_ordered_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_qty_ordered} - ${last_year_mtd_ytd_qty_ordered},${last_year_mtd_ytd_qty_ordered})'
              label: 'LY Units Comparison % (MTD or YTD)'
              group_label: 'Units'
              round: 1
      - name: last_year_same_day_qty_ordered
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_qty_ordered:
              type: sum
              label: 'LY Units Ordered (Day or WTD)'
              group_label: 'Units'
            last_year_same_day_wtd_qty_ordered_comparison:
              type: number
              sql: '${total_qty_ordered} - ${last_year_same_day_wtd_qty_ordered}'
              label: 'LY Units Comparison (Day or WTD)'
              group_label: 'Units'
            last_year_same_day_wtd_qty_ordered_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_qty_ordered} - ${last_year_same_day_wtd_qty_ordered},${last_year_same_day_wtd_qty_ordered})'
              label: 'LY Units Comparison % (Day or WTD)'
              group_label: 'Units'
              round: 1
      - name: avg_units_target
        meta:
          dimension:
            hidden: true
          metrics:
            units_target:
              type: sum
              sql: '${all_orders_target}*${avg_units_target}'
              round: 0
              label: 'Units Target'
              group_label: 'Units'
            units_target_comparison:
              type: number
              sql: '${total_qty_ordered} - ${units_target}'
              label: 'Units Target Comparison'
              group_label: 'Units'
            units_target_comparison_pct:
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_qty_ordered} - ${units_target},${units_target})'
              label: 'Units Target Comparison %'
              group_label: 'Units'
              round: 1

      #### UNIQUE VISITS
      - name: ga_unique_visits
        meta:
          dimension:
            hidden: true
          metrics:
            total_ga_unique_visits:
              type: sum
              label: 'Unique Visits'
              group_label: 'Visits'
            avg_ga_unique_visits:
              type: average
              label: 'Avg Unique Visits'
              group_label: 'Visits'
              round: 0
      - name: last_year_same_day_ga_unique_visits
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_same_day_wtd_ga_unique_visits:
              type: sum
              label: 'LY Unique Visits (Day or WTD)'
              group_label: 'Visits'
      - name: last_year_ga_unique_visits
        meta:
          dimension:
            hidden: true
          metrics:
            last_year_mtd_ytd_ga_unique_visits:
              type: sum
              label: 'LY Unique Visits (MTD or YTD)'
              group_label: 'Visits'
      - name: uv_target
        meta: 
          dimension: 
            hidden: true 
          metrics:
            unique_visits_target:
              type: string
              sql: '"N/A"'
              label: 'Unique Visits Target'
              group_label: 'Visits'

      ### INDEPENDENT TOTALS
      ### ACHICA
      - name: total_new_achica_members
        meta: 
          dimension: 
            hidden: true 
          metrics:
            new_achica_members:
              type: sum
              label: 'New Achica Members'
              group_label: 'Achica'
      - name: achica_orders
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_achica_orders:
              type: sum
              label: 'Achica Orders'
              group_label: 'Achica'
      - name: total_new_achica_order_count
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_new_achica_orders:
              type: sum
              label: 'New Achica Orders'
              group_label: 'Achica'
      - name: achica_gmv
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_achica_gmv:
              type: sum
              label: 'Achica GMV'
              group_label: 'Achica'
            achica_gmv_aov:
              type: number
              label: 'Achica AOV GMV'
              group_label: 'Achica'
              sql: 'safe_divide(${total_achica_gmv},${total_achica_orders})'
              round: 1
      - name: achica_sales_amount
        meta:
          dimension:
            hidden: true
          metrics:
            total_achica_sales_amount:
              type: sum
              label: 'Achica Sales Amount'
              group_label: 'Achica'
              hidden: true
      - name: achica_margin
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_achica_margin:
              type: sum
              label: 'Achica Margin'
              group_label: 'Achica'
            total_achica_margin_pct:
              label: 'Achica Margin (%)'
              group_label: 'Achica'
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_achica_margin},${total_achica_sales_amount})'
              round: 1
      ### COCOSA
      - name: total_new_cocosa_members
        meta: 
          dimension: 
            hidden: true 
          metrics:
            new_cocosa_members:
              type: sum
              label: 'New Cocosa Members'
              group_label: 'Cocosa'
      - name: cocosa_orders
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_cocosa_orders:
              type: sum
              label: 'Cocosa Orders'
              group_label: 'Cocosa'
      - name: total_new_cocosa_order_count
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_new_cocosa_orders:
              type: sum
              label: 'New Cocosa Orders'
              group_label: 'Cocosa'
      - name: cocosa_gmv
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_cocosa_gmv:
              type: sum
              label: 'Cocosa GMV'
              group_label: 'Cocosa'
            cocosa_gmv_aov:
              type: number
              label: 'Cocosa AOV GMV'
              group_label: 'Cocosa'
              sql: 'safe_divide(${total_cocosa_gmv},${total_cocosa_orders})'
              round: 1
      - name: cocosa_sales_amount
        meta:
          dimension:
            hidden: true
          metrics:
            total_cocosa_sales_amount:
              type: sum
              label: 'Cocosa Sales Amount'
              group_label: 'Cocosa'
              hidden: true
      - name: cocosa_margin
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_cocosa_margin:
              type: sum
              label: 'Cocosa Margin'
              group_label: 'Cocosa'
            total_cocosa_margin_pct:
              label: 'Cocosa Margin (%)'
              group_label: 'Cocosa'
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_cocosa_margin},${total_cocosa_sales_amount})'
              round: 1
      ### IFG
      - name: total_new_ifg_members
        meta: 
          dimension: 
            hidden: true 
          metrics:
            new_ifg_members:
              type: sum
              label: 'New IFG Members'
              group_label: 'IFG'
      - name: ifg_orders
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_ifg_orders:
              type: sum
              label: 'IFG Orders'
              group_label: 'IFG'
      - name: total_new_ifg_order_count
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_new_ifg_orders:
              type: sum
              label: 'New IFG Orders'
              group_label: 'IFG'
      - name: ifg_gmv
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_ifg_gmv:
              type: sum
              label: 'IFG GMV'
              group_label: 'IFG'
            ifg_gmv_aov:
              type: number
              label: 'IFG AOV GMV'
              group_label: 'IFG'
              sql: 'safe_divide(${total_ifg_gmv},${total_ifg_orders})'
              round: 1
      - name: ifg_sales_amount
        meta:
          dimension:
            hidden: true
          metrics:
            total_ifg_sales_amount:
              type: sum
              label: 'IFG Sales Amount'
              group_label: 'IFG'
              hidden: true
      - name: ifg_margin
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_ifg_margin:
              type: sum
              label: 'IFG Margin'
              group_label: 'IFG'
            total_ifg_margin_pct:
              label: 'IFG Margin (%)'
              group_label: 'IFG'
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_ifg_margin},${total_ifg_sales_amount})'
              round: 1
      ### BA
      - name: total_new_ba_members
        meta: 
          dimension: 
            hidden: true 
          metrics:
            new_ba_members:
              type: sum
              label: 'New BA Members'
              group_label: 'BA'
      - name: ba_orders
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_ba_orders:
              type: sum
              label: 'BA Orders'
              group_label: 'BA'
      - name: total_new_ba_order_count
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_new_ba_orders:
              type: sum
              label: 'New BA Orders'
              group_label: 'BA'
      - name: ba_gmv
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_ba_gmv:
              type: sum
              label: 'BA GMV'
              group_label: 'BA'
            ba_gmv_aov:
              type: number
              label: 'BA AOV GMV'
              group_label: 'BA'
              sql: 'safe_divide(${total_ba_gmv},${total_ba_orders})'
              round: 1
      - name: ba_sales_amount
        meta:
          dimension:
            hidden: true
          metrics:
            total_ba_sales_amount:
              type: sum
              label: 'BA Sales Amount'
              group_label: 'BA'
              hidden: true
      - name: ba_margin
        meta: 
          dimension: 
            hidden: true 
          metrics:
            total_ba_margin:
              type: sum
              label: 'BA Margin'
              group_label: 'BA'
            total_ba_margin_pct:
              label: 'BA Margin (%)'
              group_label: 'BA'
              type: number
              format: 'percent'
              sql: 'safe_divide(${total_ba_margin},${total_ba_sales_amount})'
              round: 1
      

  - name: kpis_daily
    description: "A view of all KPIs, based off of order creation day"
    meta:
      group_label: 'KPIs'
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_day
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_achica_order_count
      - name: total_new_cocosa_order_count
      - name: total_new_ifg_order_count
      - name: total_new_customer_count
      - name: total_existing_customer_count
      - name: total_new_members
      - name: total_new_achica_members
      - name: total_new_cocosa_members
      - name: total_new_ifg_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£/€)'
            round: 0 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£/€)'
            round: 0 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
        meta:
          dimension:
            label: 'Units Ordered'
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£/€)'
            round: 0 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£/€)'
            round: 0 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£/€)'
            round: 0 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£/€)'
            round: 0 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£/€)'
            round: 0 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£/€)'
            round: 1 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£/€)'
            round: 1 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  - name: kpis_weekly
    description: "A view of all KPIs, based off of order creation week"
    meta:
      group_label: 'KPIs'
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_week
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£/€)'
            round: 0 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£/€)'
            round: 0 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
        meta:
          dimension:
            label: 'Units Ordered'
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£/€)'
            round: 0 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£/€)'
            round: 0 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£/€)'
            round: 0 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£/€)'
            round: 0 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£/€)'
            round: 0 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£/€)'
            round: 1 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£/€)'
            round: 1 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  - name: kpis_monthly
    description: "A view of all KPIs, based off of order creation month"
    meta:
      group_label: 'KPIs'
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_month
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£/€)'
            round: 0 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£/€)'
            round: 0 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
        meta:
          dimension:
            label: 'Units Ordered'
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£/€)'
            round: 0 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£/€)'
            round: 0 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£/€)'
            round: 0 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£/€)'
            round: 0 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£/€)'
            round: 0 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£/€)'
            round: 1 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£/€)'
            round: 1 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  - name: kpis_quarterly
    description: "A view of all KPIs, based off of order creation quarter"
    meta:
      group_label: 'KPIs'
    columns:
      - name: ba_site_created_date
        tests:
          - unique
          - not_null
      - name: ba_site
      - name: order_created_at_quarter
        meta:
          dimension:
            type: date
            time_intervals: ['RAW']
      - name: total_order_count
      - name: total_new_order_count
      - name: total_new_members
      - name: shipping_amount
        description: "Shipping amount incl. tax"
        meta:
          dimension:
            label: 'Shipping Amount (£/€)'
            round: 0 
      - name: total_refund_count
      - name: total_item_refund_count
      - name: total_refund_amount
        meta:
          dimension:
            label: 'Total Refund Amount (£/€)'
            round: 0 
      - name: avg_time_to_ship_days
      - name: total_product_cost_exc_vat
        meta:
          dimension:
            round: 0 
      - name: qty_ordered
        description: "Number of items ordered across all orders"
        meta:
          dimension:
            label: 'Units Ordered'
      - name: gmv
        description: "Sales incl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'GMV (£/€)'
            round: 0 
      - name: sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping"
        meta:
          dimension:
            label: 'Sales Amount (£/€)'
            round: 0 
      - name: shipped_sales_amount
        description: "Sales excl. VAT, after any discounts and excl. shipping, and that have been shipped"
        meta:
          dimension:
            label: 'Shipped Sales Amount (£/€)'
            round: 0 
      - name: total_discount_amount
        description: "Total discount amount"
        meta:
          dimension:
            label: 'Discount Amount (£/€)'
            round: 0 
      - name: margin
        description: "Sales amount minus total product costs"
        meta:
          dimension:
            label: 'Margin (£/€)'
            round: 0 
      - name: aov_gmv
        description: "GMV divided by total number of orders"
        meta:
          dimension:
            label: 'GMV AOV (£/€)'
            round: 1 
      - name: aov_sales
        description: "Sales Amount divided by total number of orders"
        meta:
          dimension:
            label: 'Sales Amount AOV (£/€)'
            round: 1 
      - name: avg_items_per_order
      - name: pct_sales_amount_refunded
        meta:
          dimension:
            label: 'Sales Amount Refunded (%)'
      - name: pct_cs_cpo
        meta:
          dimension:
            label: 'CS CPO (%)'
      - name: conversion_rate
        meta:
          dimension:
            label: 'Conversion Rate - GA (%)'

  